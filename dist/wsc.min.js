function EventEmitter(){function a(a,b){var c=e[a]||!1;return c===!1?(e[a]=[b],f):(e[a].push(b),f)}function b(a){return e[a]=[],f}function c(){var a=Array.prototype.slice.call(arguments),b=a.shift(),c=e[b]||!1,d=0;if(c===!1)return d;for(var f in c)if(c.hasOwnProperty(f)&&(bubble=c[f].apply({},a),d++,bubble===!1))break;return d}function d(a){return e[a]||[]}var e={},f=this;this.addListener=a,this.removeListeners=b,this.emit=c,this.listeners=d}function $_GET(a,b){b=b||window.location.search;var c=new RegExp("&"+a+"(?:=([^&]*))?(?=&|$)","i");return b=b.replace(/^\?/,"&").match(c),b?"undefined"!=typeof b[1]?decodeURIComponent(b[1].replace(/\+/g,"%20")):"":void 0}function UnixTimestamp(a){return ret=new Date(1e3*a)}function PosEnd(a){return"1"==a?"st":"2"==a?"nd":"3"==a?"rd":"th"}function DateStamp(a){return a=UnixTimestamp(a),date=String(a.getDate()),month=a.getMonth(),df=date[date.length-1],date+PosEnd(df)+" of "+Months[month]+", "+a.getFullYear()}function caseInsensitiveSort(a,b){return a=a.toLowerCase(),b=b.toLowerCase(),a>b?1:b>a?-1:0}function EscapeRegExp(a){return a.replace(new RegExp("(\\"+["/",".","*","+","?","|","(",")","[","]","{","}","\\"].join("|\\")+")","g"),"\\$1")}function zeroPad(a,b){return b=b||2,b-=a.toString().length,b>0?new Array(b+(/\./.test(a)?2:1)).join("0")+a:a+""}function formatTime(a,b){return b=b||new Date,HH=b.getHours(),hh=HH,a=replaceAll(a,"{mm}",zeroPad(b.getMinutes(),2)),a=replaceAll(a,"{ss}",zeroPad(b.getSeconds(),2)),mr="am",hh>11?(mr="pm",hh>12&&(hh-=12)):0==hh&&(hh="12"),a=replaceAll(a,"{hh}",zeroPad(hh,2)),a=replaceAll(a,"{HH}",zeroPad(HH,2)),a=replaceAll(a,"{mr}",mr)}function oxlist(a){return last=a.pop(),ret=a.join(", "),ret+(ret.length>0?", and ":"")+last}function pluralise(a,b){return a+(1==b?"":"s")}function timeLengthString(a){if(0>=a)return"0 seconds.";var b=a,c=[];c.unshift(["second",Math.round(b%60)]),b/=Math.round(60),c.unshift(["minute",Math.round(b%60)]),b/=Math.round(60),c.unshift(["hour",Math.round(b%24)]),b/=Math.round(24),c.unshift(["day",b]);var d=[];for(i in c)lapse=c[i],lapse[1]<1||d.push(lapse[1].toString()+" "+pluralise(lapse[0],lapse[1]));return oxlist(d)}function StringSet(a){this.items=a||[]}function wsc_packetstr(a,b,c,d){var e="";if(a&&(e=a,b&&(e=e+" "+b)),c)for(var f in c)e=e+"\n"+f+"="+c[f];return e+="\n",d&&(e=e+"\n"+d),e}function packetToString(a){return wsc_packetstr(a.cmd,a.param,a.arg,a.body)}function packetEvtName(a){var b=a.cmd,c=null;for(var d in chains)if(c=chains[d],c[0]==b){var e=a.sub[0];if(b=b+"_"+e.cmd,c.length>1&&void 0!=e.param&&c[1]==e.cmd)return b+"_"+e.param}return b}var wsc={};wsc.VERSION="1.7.54",wsc.STATE="release candidate",wsc.REVISION="0.21.139",wsc.defaults={},wsc.defaults.theme="wsct_dark",wsc.defaults.themes=["wsct_dAmn","wsct_dark"];var CryptoJS=CryptoJS||function(a,b){var c={},d=c.lib={},e=function(){},f=d.Base={extend:function(a){e.prototype=this;var b=new e;return a&&b.mixIn(a),b.hasOwnProperty("init")||(b.init=function(){b.$super.init.apply(this,arguments)}),b.init.prototype=b,b.$super=this,b},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},g=d.WordArray=f.extend({init:function(a,c){a=this.words=a||[],this.sigBytes=c!=b?c:4*a.length},toString:function(a){return(a||i).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes;if(a=a.sigBytes,this.clamp(),d%4)for(var e=0;a>e;e++)b[d+e>>>2]|=(c[e>>>2]>>>24-8*(e%4)&255)<<24-8*((d+e)%4);else if(65535<c.length)for(e=0;a>e;e+=4)b[d+e>>>2]=c[e>>>2];else b.push.apply(b,c);return this.sigBytes+=a,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-8*(c%4),b.length=a.ceil(c/4)},clone:function(){var a=f.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var c=[],d=0;b>d;d+=4)c.push(4294967296*a.random()|0);return new g.init(c,b)}}),h=c.enc={},i=h.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;a>d;d++){var e=b[d>>>2]>>>24-8*(d%4)&255;c.push((e>>>4).toString(16)),c.push((15&e).toString(16))}return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-4*(d%8);return new g.init(c,b/2)}},j=h.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;a>d;d++)c.push(String.fromCharCode(b[d>>>2]>>>24-8*(d%4)&255));return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;b>d;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-8*(d%4);return new g.init(c,b)}},k=h.Utf8={stringify:function(a){try{return decodeURIComponent(escape(j.stringify(a)))}catch(b){throw Error("Malformed UTF-8 data")}},parse:function(a){return j.parse(unescape(encodeURIComponent(a)))}},l=d.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=k.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,f=this.blockSize,h=e/(4*f),h=b?a.ceil(h):a.max((0|h)-this._minBufferSize,0);if(b=h*f,e=a.min(4*b,e),b){for(var i=0;b>i;i+=f)this._doProcessBlock(d,i);i=d.splice(0,b),c.sigBytes-=e}return new g.init(i,e)},clone:function(){var a=f.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});d.Hasher=l.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){return a&&this._append(a),this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new m.HMAC.init(a,c).finalize(b)}}});var m=c.algo={};return c}(Math);!function(a){function b(a,b,c,d,e,f,g){return a=a+(b&c|~b&d)+e+g,(a<<f|a>>>32-f)+b}function c(a,b,c,d,e,f,g){return a=a+(b&d|c&~d)+e+g,(a<<f|a>>>32-f)+b}function d(a,b,c,d,e,f,g){return a=a+(b^c^d)+e+g,(a<<f|a>>>32-f)+b}function e(a,b,c,d,e,f,g){return a=a+(c^(b|~d))+e+g,(a<<f|a>>>32-f)+b}for(var f=CryptoJS,g=f.lib,h=g.WordArray,i=g.Hasher,g=f.algo,j=[],k=0;64>k;k++)j[k]=4294967296*a.abs(a.sin(k+1))|0;g=g.MD5=i.extend({_doReset:function(){this._hash=new h.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(a,f){for(var g=0;16>g;g++){var h=f+g,i=a[h];a[h]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var g=this._hash.words,h=a[f+0],i=a[f+1],k=a[f+2],l=a[f+3],m=a[f+4],n=a[f+5],o=a[f+6],p=a[f+7],q=a[f+8],r=a[f+9],s=a[f+10],t=a[f+11],u=a[f+12],v=a[f+13],w=a[f+14],x=a[f+15],y=g[0],z=g[1],A=g[2],B=g[3],y=b(y,z,A,B,h,7,j[0]),B=b(B,y,z,A,i,12,j[1]),A=b(A,B,y,z,k,17,j[2]),z=b(z,A,B,y,l,22,j[3]),y=b(y,z,A,B,m,7,j[4]),B=b(B,y,z,A,n,12,j[5]),A=b(A,B,y,z,o,17,j[6]),z=b(z,A,B,y,p,22,j[7]),y=b(y,z,A,B,q,7,j[8]),B=b(B,y,z,A,r,12,j[9]),A=b(A,B,y,z,s,17,j[10]),z=b(z,A,B,y,t,22,j[11]),y=b(y,z,A,B,u,7,j[12]),B=b(B,y,z,A,v,12,j[13]),A=b(A,B,y,z,w,17,j[14]),z=b(z,A,B,y,x,22,j[15]),y=c(y,z,A,B,i,5,j[16]),B=c(B,y,z,A,o,9,j[17]),A=c(A,B,y,z,t,14,j[18]),z=c(z,A,B,y,h,20,j[19]),y=c(y,z,A,B,n,5,j[20]),B=c(B,y,z,A,s,9,j[21]),A=c(A,B,y,z,x,14,j[22]),z=c(z,A,B,y,m,20,j[23]),y=c(y,z,A,B,r,5,j[24]),B=c(B,y,z,A,w,9,j[25]),A=c(A,B,y,z,l,14,j[26]),z=c(z,A,B,y,q,20,j[27]),y=c(y,z,A,B,v,5,j[28]),B=c(B,y,z,A,k,9,j[29]),A=c(A,B,y,z,p,14,j[30]),z=c(z,A,B,y,u,20,j[31]),y=d(y,z,A,B,n,4,j[32]),B=d(B,y,z,A,q,11,j[33]),A=d(A,B,y,z,t,16,j[34]),z=d(z,A,B,y,w,23,j[35]),y=d(y,z,A,B,i,4,j[36]),B=d(B,y,z,A,m,11,j[37]),A=d(A,B,y,z,p,16,j[38]),z=d(z,A,B,y,s,23,j[39]),y=d(y,z,A,B,v,4,j[40]),B=d(B,y,z,A,h,11,j[41]),A=d(A,B,y,z,l,16,j[42]),z=d(z,A,B,y,o,23,j[43]),y=d(y,z,A,B,r,4,j[44]),B=d(B,y,z,A,u,11,j[45]),A=d(A,B,y,z,x,16,j[46]),z=d(z,A,B,y,k,23,j[47]),y=e(y,z,A,B,h,6,j[48]),B=e(B,y,z,A,p,10,j[49]),A=e(A,B,y,z,w,15,j[50]),z=e(z,A,B,y,n,21,j[51]),y=e(y,z,A,B,u,6,j[52]),B=e(B,y,z,A,l,10,j[53]),A=e(A,B,y,z,s,15,j[54]),z=e(z,A,B,y,i,21,j[55]),y=e(y,z,A,B,q,6,j[56]),B=e(B,y,z,A,x,10,j[57]),A=e(A,B,y,z,o,15,j[58]),z=e(z,A,B,y,v,21,j[59]),y=e(y,z,A,B,m,6,j[60]),B=e(B,y,z,A,t,10,j[61]),A=e(A,B,y,z,k,15,j[62]),z=e(z,A,B,y,r,21,j[63]);g[0]=g[0]+y|0,g[1]=g[1]+z|0,g[2]=g[2]+A|0,g[3]=g[3]+B|0},_doFinalize:function(){var b=this._data,c=b.words,d=8*this._nDataBytes,e=8*b.sigBytes;c[e>>>5]|=128<<24-e%32;var f=a.floor(d/4294967296);for(c[(e+64>>>9<<4)+15]=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8),c[(e+64>>>9<<4)+14]=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8),b.sigBytes=4*(c.length+1),this._process(),b=this._hash,c=b.words,d=0;4>d;d++)e=c[d],c[d]=16711935&(e<<8|e>>>24)|4278255360&(e<<24|e>>>8);return b},clone:function(){var a=i.clone.call(this);return a._hash=this._hash.clone(),a}}),f.MD5=i._createHelper(g),f.HmacMD5=i._createHmacHelper(g)}(Math),wsc.Transport=function(a,b,c,d){this.sock=null,this.conn=null,this.server=a,this.open(b),this.message(c),this.disconnect(d)},wsc.Transport.Create=function(a,b,c,d){if("undefined"!=typeof io)return new wsc.SocketIO(a,b,c,d);if(!window.WebSocket)throw"This browser does not support websockets.";return new wsc.WebSocket(a,b,c,d)},wsc.Transport.prototype.open=function(a){this._open=a||this.sopen},wsc.Transport.prototype.message=function(a){this._message=a||this.smessage},wsc.Transport.prototype.disconnect=function(a){this._disconnect=a||this.sdisconnect},wsc.Transport.prototype.sopen=function(){},wsc.Transport.prototype.smessage=function(){},wsc.Transport.prototype.sdisconnect=function(){},wsc.Transport.prototype._open=function(){},wsc.Transport.prototype._message=function(){},wsc.Transport.prototype._disconnect=function(){},wsc.Transport.prototype.connect=function(){},wsc.Transport.prototype.send=function(){},wsc.Transport.prototype.close=function(){},wsc.WebSocket=function(a,b,c,d){this.sock=null,this.conn=null,this.server=a,this.cause=null,this.open(b),this.message(c),this.disconnect(d)},wsc.WebSocket.prototype=new wsc.Transport,wsc.WebSocket.prototype.constructor=wsc.WebSocket,wsc.WebSocket.prototype.onopen=function(a,b){this.sock=b||this.conn,this._open(a,this)},wsc.WebSocket.prototype.ondisconnect=function(a){this.sock=null,this.conn=null,this._disconnect({wsEvent:a,cause:this.cause})},wsc.WebSocket.prototype.connect=function(){var a=this;this.conn=new WebSocket(this.server),this.conn.onopen=function(b,c){a.onopen(b,c)},this.conn.onmessage=this._message,this.conn.onclose=function(b){a.ondisconnect(b)}},wsc.WebSocket.prototype.send=function(a){return null==this.sock?-1:this.sock.send(replaceAll(escape(a).replace(/\%u([\dA-F]{4})/g,"%26%23x$1%3B"),"+","%2B"))},wsc.WebSocket.prototype.close=function(a){null!=this.sock&&(this.cause=a,this.sock.close())},wsc.SocketIO=function(a,b,c,d){this.sock=null,this.conn=null,this.server=a,this.open(b),this.message(c),this.disconnect(d)},wsc.SocketIO.prototype=new wsc.Transport(""),wsc.SocketIO.prototype.constructor=wsc.SocketIO,wsc.SocketIO.prototype.connect=function(){var a=this;this.conn=io.connect(this.server),this.conn.on("connect",function(b,c){a.onopen(b,c)}),this.conn.on("message",function(b){a._message({data:b})}),this.conn.on("close",function(b){a.ondisconnect(b)})},wsc.SocketIO.prototype.onopen=function(a,b){this.sock=b||this.conn,this._open(a,this)},wsc.SocketIO.prototype.ondisconnect=function(a){this.sock=null,this.conn=null,this._disconnect(a)},wsc.SocketIO.prototype.send=function(a){return null==this.sock?-1:this.sock.send(replaceAll(escape(a).replace(/\%u([\dA-F]{4})/g,"%26%23x$1%3B"),"+","%2B"))},wsc.SocketIO.prototype.close=function(){null!=this.sock&&this.sock.close()};var Months=["January","February","March","April","May","June","July","August","September","October","November","December"];String.format=function(){var a=Array.prototype.slice.call(arguments),b=a.shift();if(a=a.shift(),0==a.length)return b;var c=a.length;return b.replace(/{(\d+)}/g,function(b,d){return c<=parseInt(d)?b:"undefined"!=typeof a[d]?a[d]:b})},replaceAllRaw=function(a,b,c){for(;a.indexOf(b)>-1;)a=a.replace(b,c);return a},replaceAll=function(a,b,c){return a.split(b).join(c)},Object.size=function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c},Object.steal=function(a,b){for(var c in b)(a.hasOwnProperty(c)||b.hasOwnProperty(c))&&(a[c]="object"==typeof a[c]?Object.extend(a[c],b[c]):b[c])},Object.extend=function(a,b){var c={};return Object.steal(c,a),Object.steal(c,b),c},StringSet.prototype.add=function(a,b){return a?(a=a.toLowerCase(),this.contains(a)?!0:(b?this.items.unshift(a):this.items.push(a),!0)):!1},StringSet.prototype.remove=function(a){return a?(a=a.toLowerCase(),this.contains(a)?(this.items.splice(this.items.indexOf(a),1),!0):!0):!1},StringSet.prototype.contains=function(a){return a?-1!=this.items.indexOf(a.toLowerCase()):!1},wsc.Middleware=function(){this.callbacks={}},wsc.Middleware.prototype.add=function(a,b){var c=this.callbacks[a]||!1;return c===!1&&(this.callbacks[a]=[]),this.callbacks[a].push(b),this.callbacks[a].length},wsc.Middleware.prototype.run=function(a,b,c){var d=(this.callbacks[a]||[]).slice();d.push(b);var e=function(a){d.shift()(a,e)};e(c)},wsc.Storage=function(a,b){this.ns=a||null,this.parent=b||null},wsc.Storage.prototype.folder=function(a){return null!=this.ns&&(a=this.ns+"."+a),new wsc.Storage(a,this)},wsc.Storage.prototype.get=function(a,b){null!=this.ns&&(a=this.ns+"."+a);try{return localStorage.hasOwnProperty(a)?localStorage[a]:b}catch(c){return b}},wsc.Storage.prototype.set=function(a,b){null!=this.ns&&(a=this.ns+"."+a);try{localStorage[a]=b}catch(c){}},wsc.Storage.prototype.remove=function(a){null!=this.ns&&(a=this.ns+"."+a);try{return localStorage.hasOwnProperty(a)?delete localStorage[a]:!1}catch(b){}return!1};var chains=[["recv","admin"]];with(wsc.Packet=function(a,b,c){if(!a)return null;void 0===c&&(c=!0),b=b||"=";var d={cmd:null,param:null,arg:{},body:null,sub:[],raw:a},e=null,f=-1;try{f=a.indexOf("\n\n"),f>-1&&(d.body=a.substr(f+2),a=a.substr(0,f)),e=a.split("\n"),-1==e[0].indexOf(b)&&(cline=e.shift().split(" "),d.cmd=cline.shift()||null,d.param=cline.join(" ")||null);for(var g in e)arg=e[g],f=arg.search(b),-1!=f&&(d.arg[arg.substr(0,f)]=arg.substr(f+b.length)||"");if(null!=d.body&&c){subs=d.body.split("\n\n");for(var h in subs){if(sub=wsc.Packet(subs[h],b,!1),null==sub)break;sub.body=subs.slice(h+1).join("\n\n"),d.sub.push(sub)}}}catch(i){return null}return d.toString=function(){return packetToString(d)},d.name=packetEvtName(d),d},wsc.Channel=function(a,b,c,d){this.info={members:{},pc:{},pc_order:[],title:{content:"",by:"",ts:""},topic:{content:"",by:"",ts:""}},this.client=a,this.hidden=c,this.monitor=void 0==d?!1:d,this.raw=a.format_ns(b),this.selector=("pc"==this.raw.substr(0,2)?"pc":"c")+"-"+a.deform_ns(b).slice(1).toLowerCase(),this.namespace=a.deform_ns(b),this.monitor=0==Object.size(this.client.channelo)},wsc.Channel.prototype.build=function(){this.info.members={},"@"==this.namespace[0]&&this.set_privclasses({pkt:{body:""}})},wsc.Channel.prototype.property=function(a){var b=a.pkt.arg.p;switch(b){case"title":case"topic":this.set_header(b,a);break;case"privclasses":this.set_privclasses(a);break;case"members":this.set_members(a);break;default:this.server_message("Received unknown property "+b+" received in "+this.info.namespace+".")}},wsc.Channel.prototype.set_header=function(a,b){this.info[a].content=b.value.text()||"",this.info[a].by=b.by,this.info[a].ts=b.ts},wsc.Channel.prototype.set_privclasses=function(a){if("@"==this.namespace[0])this.info.pc={100:"Room Members"},this.info.pc_order=[100];else{this.info.pc={},this.info.pc_order=[];var b=a.pkt.body.split("\n"),c=[];for(var d in b)b.hasOwnProperty(d)&&(c=b[d].split(":"),1!=c.length&&(this.info.pc_order.push(parseInt(c[0])),this.info.pc[parseInt(c[0])]=c[1]))}this.info.pc_order.sort(function(a,b){return b-a});this.info.pc,this.info.pc_order.slice(0)},wsc.Channel.prototype.get_privclass_order=function(a){a=a.toLowerCase();for(var b in this.info.pc)if(this.info.pc.hasOwnProperty(b)&&this.info.pc[b].toLowerCase()==a)return b},wsc.Channel.prototype.set_members=function(a){this.info.members={};for(var b in a.pkt.sub)a.pkt.sub.hasOwnProperty(b)&&this.register_user(a.pkt.sub[b],!0);this.set_user_list()},wsc.Channel.prototype.set_user_list=function(){if(0!=Object.size(this.info.members)){var a=this.get_usernames(),b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(this.info.members[a[c]]);this.client.trigger("ns.user.list",{name:"set.userlist",ns:this.namespace,users:b})}},wsc.Channel.prototype.user_info=function(a){var b=this.info.members[a],c=b.symbol;return{name:a,pc:b.pc||"Room Members",symbol:c,conn:b.conn,hover:{member:b,name:a,avatar:'<img class="avatar" src="" height="50" width="50" />',link:c+'<a target="_blank" href="http://'+a+"."+this.client.settings.domain+'/">'+a+"</a>",info:[]}}},wsc.Channel.prototype.register_user=function(a,b){var c=a.param;if(void 0==this.info.members[c])this.info.members[c]=a.arg,this.info.members[c].username=c,this.info.members[c].conn=1,this.info.members[c]=this.user_info(c);else{for(i in a.arg)this.info.members[c][i]=a.arg[i];this.info.members[c].conn++}"pc"in this.info.members[c]||(this.info.members[c].pc="Room Members"),b=b||!1,b||this.client.trigger("ns.user.registered",{name:"ns.user.registered",ns:this.namespace,user:c})},wsc.Channel.prototype.get_usernames=function(){var a=[];for(var b in this.info.members)a.push(b);return a.sort(caseInsensitiveSort),a},wsc.Channel.prototype.remove_user=function(a,b){b=b||!1;var c=this.info.members[a];void 0!=c&&(c.conn--,(0==c.conn||b)&&delete this.info.members[a],this.client.trigger("ns.user.remove",{user:c.name,ns:this.namespace}))},wsc.Channel.prototype.recv_join=function(a){var b=new wsc.Packet("user "+a.user+"\n"+a.info);this.register_user(b)},wsc.Channel.prototype.recv_part=function(a){this.remove_user(a.user)},wsc.Channel.prototype.recv_privchg=function(a){var b=this;this.client.cascade("ns.user.privchg",function(a){var c=b.info.members[a.user];c&&(c.pc=a.pc)},a)},wsc.Channel.prototype.recv_kicked=function(a){this.remove_user(a.user,!0),this.set_user_list()},wsc.MessageString=function(a,b){this._parser=b||new wsc.MessageParser,this.raw=a},wsc.MessageString.prototype=new String)constructor=wsc.MessageParser,toString=valueOf=function(){return this.raw};wsc.MessageString.prototype.html=function(){return this.raw},wsc.MessageString.prototype.text=function(){return this.raw},wsc.MessageString.prototype.ansi=function(){return this.raw},wsc.MessageParser=function(){},wsc.MessageParser.prototype.parse=function(a){return new wsc.MessageString(a,this)},wsc.MessageParser.prototype.render=function(a,b){return b.raw},wsc.Protocol=function(a){this.mparser=a||new wsc.MessageParser,this.chains=[["recv","admin"]],this.maps={chatserver:["version"],login:["username",["e"],"data"],join:["ns",["e"]],part:["ns",["e","*r"]],property:["ns",["p","by","ts"],"*value"],recv_msg:[null,[["from","user"]],"*message"],recv_npmsg:[null,[["from","user"]],"message"],recv_action:[null,["s",["from","user"]],"*message"],recv_join:["user",["s"],"*info"],recv_part:["user",["s","r"]],recv_privchg:["user",["s","by","pc"]],recv_kicked:["user",[["i","s"],"by"],"*r"],recv_admin_create:[null,["p",["by","user"],["name","pc"],"privs"]],recv_admin_update:[null,["p",["by","user"],["name","pc"],"privs"]],recv_admin_rename:[null,["p",["by","user"],"prev",["name","pc"]]],recv_admin_move:[null,["p",["by","user"],"prev",["name","pc"],["n","affected"]]],recv_admin_remove:[null,["p",["by","user"],["name","pc"],["n","affected"]]],recv_admin_show:[null,["p"],"info"],recv_admin_showverbose:[null,["p"],"info"],recv_admin_privclass:[null,["p","e"],"command"],kicked:["ns",[["by","user"]],"*r"],ping:[],disconnect:[null,["e"]],send:["ns",["e"]],kick:["ns",[["u","user"],"e"]],get:["ns",["p","e"]],set:["ns",["p","e"]],kill:["ns",["e"]],unknown:[null,null,null,"packet"]};var b=this;this.mapper={recv:function(a,c,d){return c.ns=a.param,b.map(a.sub[0],c,d)}}},wsc.Protocol.prototype.extend_maps=function(a){for(var b in a)this.maps[b]=a[b]},wsc.Protocol.prototype.populate_keys=function(){this.tkeys={};for(var a in this.maps)if(this.maps.hasOwnProperty(a)){var b=this.maps[a],c="";this.tkeys[a]=[];for(var d in b)if(b.hasOwnProperty(d)&&(c=b[d]))if(1!=d)this.tkeys[a].push("*"==c[0]?c.substr(1):c);else{var e="";for(var f in c)c.hasOwnProperty(f)&&(e=c[f],e&&(e instanceof Array&&(e=e[1]),this.tkeys[a].push("*"==e[0]?e.substr(1):e)))}}},wsc.Protocol.prototype.parse=function(a){var b=this.event(a);b in this.maps?mapping=this.maps[b]:(console.log("unknown: ",b),console.log(this.maps),mapping=this.maps.unknown,b="unknown");var c={name:b,pkt:a,ns:null};return cmd=a.cmd,this.mapper[cmd]?this.mapper[cmd](a,c,mapping):this.map(a,c,mapping),c},wsc.Protocol.prototype.event=function(a){var b=a.cmd,c=null;for(var d in this.chains)if(c=this.chains[d],c[0]==b){var e=a.sub[0];if(b=b+"_"+e.cmd,c.length>1&&void 0!=e.param&&c[1]==e.cmd)return b+"_"+e.param}return b},wsc.Protocol.prototype.map=function(a,b,c){for(var d in c)if(null!=c[d]){var e=c[d],f=e,g="",h="";switch(parseInt(d)){case 0:b[e]=a.param;break;case 1:if(c[1]instanceof Array)for(var i in c[1])if(e=c[1][i],e instanceof Array)b[e[1]]=a.arg[e[0]],f=e[1];else{var g="*"==e[0]?e.slice(1):e;b[e]=a.arg[g]||"",f=e}"string"==typeof c[1]&&(b[e]=a.arg.slice(0));break;case 2:e instanceof Array?(a.sub[0].sub=a.sub.slice(1),this.map(a.sub[0],b,e)):b[e]=a.body;break;case 3:b[e]=a.raw}"*"==f[0]&&(g=f.slice(1),h=this.mparser.parse(b[f]),b[g]=h)}},wsc.Flow=function(a){this.protocol=a||new wsc.Protocol},wsc.Flow.prototype.open=function(a){a.trigger("connected",{name:"connected",pkt:new wsc.Packet("connected\n\n")}),a.connected=!0,a.handshake(),a.attempts=0},wsc.Flow.prototype.close=function(a,b){var c={name:"closed",pkt:new wsc.Packet("connection closed\n\n"),reason:"",evt:b,connected:a.connected,sio:a.conn instanceof wsc.SocketIO,cause:b.cause||null,reconnect:!0},d={name:"log",ns:"~System",msg:"",info:""};if(a.trigger("closed",c),a.connected){if(d.msg="Connection closed",a.trigger("log",d),a.connected=!1,a.conn instanceof wsc.SocketIO)return d.msg="At the moment there is a problem with reconnecting with socket.io",d.info="Refresh to connect",a.trigger("log",d),void(d.info="")}else d.msg="Connection failed",a.trigger("log",d);return c.name="quit",a.attempts>2?(c.reconnect=!1,a.attempts=0,void a.trigger("quit",c)):b.cause&&b.cause.hasOwnProperty("name")&&"login"==b.cause.name?void a.trigger("quit",c):void setTimeout(function(){a.connect()},2e3)},wsc.Flow.prototype.message=function(a,b){var c=new wsc.Packet(unescape(replaceAll(b.data,"+"," ")));if(null!=c){var d=this.protocol.parse(c);null==d.ns&&(d.ns=a.mns),d.sns=a.deform_ns(d.ns),this.handle(a,d),a.trigger("pkt",d),a.trigger("pkt."+d.name,d)}},wsc.Flow.prototype.handle=function(a,b){try{this[b.name](b,a)}catch(c){}},wsc.Flow.prototype.ping=function(a,b){b.pong()},wsc.Flow.prototype.chatserver=function(a,b){b.login()},wsc.Flow.prototype.login=function(a,b){if("ok"==a.pkt.arg.e){var c=a.pkt.sub[0];b.settings.username=a.pkt.param,b.settings.symbol=c.arg.symbol,b.settings.userinfo=c.arg}else b.close(a);b.fresh&&(b.fresh=!1)},wsc.Flow.prototype.join=function(a,b){if("ok"==a.pkt.arg.e){var c=b.deform_ns(a.pkt.param);b.create_ns(c,b.hidden.contains(a.pkt.param))}else b.trigger("log",{name:"log",ns:"server:current",sns:"~current",msg:"Failed to join "+b.deform_ns(a.pkt.param),info:a.pkt.arg.e})},wsc.Flow.prototype.part=function(a,b){var c=b.deform_ns(a.ns),d=b.channel(c);if("ok"==a.e){if(info="",a.r.length>0?info="["+a.r+"]":b.remove_ns(a.ns),msg="You have left "+c,d.server_message(msg,info),0==b.channels()){switch(a.r){case"bad data":case"bad msg":case"msg too big":break;default:if(a.r.indexOf("killed:")<0)return}this.message(b,{data:"disconnect\ne="+e.r+"\n"})}}else b.trigger("log",{name:"log",ns:"server:current",sns:"~current",msg:"Couldn't leave "+c,info:a.e})},wsc.Flow.prototype.kicked=function(a,b){a.r.toLowerCase().indexOf("autokicked")>-1||b.join(a.ns)},wsc.Flow.prototype.property=function(a,b){chan=b.channel(a.pkt.param),chan&&chan.property(a)},wsc.Flow.prototype.recv_joinpart=function(a,b){c=b.channel(a.ns),"recv_join"==a.name?c.recv_join(a):c.recv_part(a)},wsc.Flow.prototype.recv_join=wsc.Flow.prototype.recv_joinpart,wsc.Flow.prototype.recv_part=wsc.Flow.prototype.recv_joinpart,wsc.Flow.prototype.recv_msg=function(a,b){b.channel(a.ns).recv_msg(a)},wsc.Flow.prototype.recv_action=wsc.Flow.prototype.recv_msg,wsc.Flow.prototype.recv_npmsg=wsc.Flow.prototype.recv_msg,wsc.Flow.prototype.recv_privchg=function(a,b){b.channel(a.ns).recv_privchg(a)},wsc.Flow.prototype.recv_kicked=function(a,b){b.channel(a.ns).recv_kicked(a)},wsc.defaults.Extension=function(a){var b={},c=function(){a.bind("cmd.connect",d.connection),a.bind("cmd.set",d.setter),a.bind("cmd.join",d.join),a.bind("cmd.chat",d.pjoin),a.bind("cmd.part",d.part),a.bind("cmd.say",d.say),a.bind("cmd.npmsg",d.npmsg),a.bind("cmd.me",d.action),a.bind("cmd.promote",d.chgpriv),a.bind("cmd.demote",d.chgpriv),a.bind("cmd.ban",d.ban),a.bind("cmd.unban",d.ban),a.bind("cmd.kick",d.killk),a.bind("cmd.whois",d.whois),a.bind("cmd.title",d.title),a.bind("cmd.topic",d.title),a.bind("cmd.admin",d.admin),a.bind("cmd.disconnect",d.connection),a.bind("cmd.kill",d.killk),a.bind("cmd.raw",d.raw),a.bind("cmd.close",d.close),a.bind("pkt.property",e),a.bind("pkt.recv_admin_show",g),a.bind("pkt.recv_admin_showverbose",g),a.bind("pkt.get",f)};b.save=function(b){a.settings.ui.theme=b.theme,a.settings.ui.clock=b.clock,a.settings.ui.tabclose=b.tabclose};var d={};d.setter=function(b){var c=b.args.split(" "),d=c.shift().toLowerCase(),c=c.join(" ");return 0==c.length?void a.cchannel.serverMessage("Could not set "+d,"No data supplied"):d in a.settings?(a.settings[d]=c,void a.cchannel.serverMessage("Changed "+d+" setting","value: "+c)):void a.cchannel.serverMessage('Unknown setting "'+d+'"')},d.connection=function(b){a[b.cmd]()},d.join=function(b){var c=b.args.split(" "),c=""==c.toString()?[]:c;if(b.ns!=b.target&&c.unshift(b.target),""!=c.toString())for(index in c)a.join(c[index])},d.pjoin=function(b){var c=b.args.split(" "),c=""==c.toString()?[]:c;if(b.ns!=b.target&&c.unshift(b.target),""!=c.toString())for(index in c)a.join("@"+c[index])},d.part=function(b){var c=b.args.split(" ");if(b.ns!=b.target&&c.unshift(b.target),""==c.toString())return void a.part(b.ns);for(index in c)a.part(c[index])},d.title=function(b){a.set(b.target,b.cmd,b.args)},d.chgpriv=function(b){var c=b.args.split(" ");a[b.cmd.toLowerCase()](b.target,c[0],c[1])},d.ban=function(a,b){var c=a.args.split(" "),d=c.shift(),e=a.cmd;"ban"==e&&c.length>0&&b.kick(a.target,d,c.join(" ")),b[e](a.target,d)},d.action=function(b){a.action(b.target,b.args)},d.raw=function(b){a.send(b.args.replace(/\\n/gm,"\n"))},d.killk=function(a,b){var c=a.args.split(" "),d=c.shift(),e=c.length>0?c.join(" "):null;"kick"==a.cmd?b.kick(a.target,d,e):b.kill(d,e)},d.say=function(b){a.channel(b.target).monitor||a.say(b.target,b.args)},d.npmsg=function(b){a.npmsg(b.target,b.args)},d.close=function(b){a.part(b.target),a.remove_ns(b.target)},d.whois=function(a,b){b.whois(a.args.split(" ")[0])},d.admin=function(a,b){b.admin(a.target,a.args)},d.disconnect=function(a,b){b.disconnect()};var e=function(a,b){if("info"==a.p){var c=a.pkt.sub,d=c.shift().arg;d.username=a.sns.substr(1),d.connections=[];for(var e=null,f={};c.length>0;)switch(f=c.shift(),f.cmd){case"conn":null!=e&&d.connections.push(e),e=f.arg,e.channels=[];break;case"agent":e.agent=[["agent",f.arg.agent]],f.arg.hasOwnProperty("url")&&e.agent.push(["url",f.arg.url]),f.arg.hasOwnProperty("browser")&&e.agent.push(["browser",f.arg.browser]);for(var g in f.arg)"agent"!=g&&"url"!=g&&"browser"!=g&&f.arg.hasOwnProperty(g)&&e.agent.push([g,f.arg[g]]);break;case"ns":e.channels.unshift(b.deform_ns(f.param))}d.connections.push(e),b.trigger("pkt.whois",{name:"pkt.whois",pkt:a.pkt,info:d})}},f=function(a,b){if(0==a.ns.indexOf("login:")){var c=a.sns.substr(1);b.ui.pager.notice({ref:"whois-"+c,heading:"Whois Failed",content:"Whois failed for "+c+".\nNo such user online."},!1,5e3)}},g=function(a,b){var c=b.channel(a.ns),d=a.info.split("\n"),e="",f=[],g="";for(var h in d)d.hasOwnProperty(h)&&(e=d[h].split(" "),"privclass"==a.p?f.push([e.shift(),e.shift().split("=")[1],e.join(" ")]):"users"==a.p&&(g=e.shift().split(":",1)[0],f.push([g,c.get_privclass_order(g),e.join(" ")])));b.ui.chatbook.current.log_pc("privclass"==a.p,f)};return c(),wsc.defaults.Extension.Ignore(a,b),wsc.defaults.Extension.Away(a,b),wsc.defaults.Extension.Autojoin(a,b),b},wsc.defaults.Extension.Autojoin=function(a,b){b.autojoin={on:!1,channel:[]};var c=!0,d=a.storage.folder("autojoin"),e=function(){b.autojoin.load(),b.autojoin.save(),a.bind("cmd.autojoin",g),a.bind("pkt.login",f)};b.autojoin.load=function(){b.autojoin.on="true"==d.get("on","true"),b.autojoin.channel=JSON.parse(d.get("channel","[]"))},b.autojoin.save=function(){d.set("on",b.autojoin.on.toString()),d.set("channel",JSON.stringify(b.autojoin.channel))},b.autojoin.join=function(){for(var c in b.autojoin.channel)b.autojoin.channel.hasOwnProperty(c)&&a.join(b.autojoin.channel[c])},b.autojoin.add=function(a){return-1!=b.autojoin.channel.indexOf(a)?!1:(b.autojoin.channel.push(a),b.autojoin.save(),!0)},b.autojoin.remove=function(a){var c=b.autojoin.channel.indexOf(a);return-1==c?!1:(b.autojoin.channel.splice(c,1),b.autojoin.save(),!0)};var f=function(a,d){if("ok"==a.e){if(c)d.join(d.settings.autojoin),b.autojoin.on&&b.autojoin.join();else{var e=!1;for(key in d.channelo)"~"!=d.channelo[key].namespace[0]&&(d.join(key),e=!0);e||b.autojoin.join()}c=!1}},g=function(c){var d=c.args.split(" ");if(d){{var e=d.shift().toLowerCase(),f=null,g="",h="",i=!1;a.channel(c.ns)}switch(e){case"add":f=b.autojoin.add,g="Added {item} to your autojoin.",h="Already have {item} on your autojoin.";break;case"rem":case"remove":f=b.autojoin.remove,g="Removed {item} from your autojoin.",h=j+" is not on your autojoin list.";break;case"on":a.trigger("log",{name:"log",ns:"server:current",sns:"~current",msg:"Autojoin on"}),b.autojoin.on||(i=!0,b.autojoin.on=!0);break;case"off":a.trigger("log",{name:"log",ns:"server:current",sns:"~current",msg:"Autojoin off"}),b.autojoin.on&&(i=!0,b.autojoin.on=!1);break;default:b.autojoin.join()}var j="",k=!1;if(null!=f)for(var l in d)d.hasOwnProperty(l)&&(j=a.deform_ns(d[l]).toLowerCase(),k=f(j),a.trigger("log",{name:"log",ns:"server:current",sns:"~current",msg:replaceAll(k?g:h,"{item}",j)}));i&&b.autojoin.save()}};e()},wsc.defaults.Extension.Away=function(a,b){var c=a.storage.folder("away");b.away={on:!1,reason:"",last:{},since:0,interval:6e4,format:{setaway:"/me is away: {reason}",setback:"/me is back",away:"{user}: I've been away for {timesince}. Reason: {reason}"}},a.away=b.away;var d=function(){b.away.load(),b.away.save(),a.bind("cmd.setaway",e),a.bind("cmd.setback",f),a.bind("pkt.recv_msg",g),a.bind("pkt.recv_action",g)},e=function(a,c){b.away.on=!0,b.away.last={},b.away.since=new Date,b.away.reason=a.args;var d=c.say,e=replaceAll(b.away.format.setaway,"{reason}",b.away.reason||"[silent away]");0==e.indexOf("/me ")&&(e=e.substr(4),d=c.action),c.each_channel(function(a){d.call(c,a,e)}),c.trigger("ext.away.away",{name:"ext.away.away",reason:b.away.reason||"[silent away]"})},f=function(a,c){if(b.away.on){b.away.on=!1;var d=c.say,e=b.away.format.setback;0==e.indexOf("/me ")&&(e=e.substr(4),d=c.action),c.each_channel(function(a){d.call(c,a,e)}),c.trigger("ext.away.back",{name:"ext.away.back"})}},g=function(c){if(b.away.on&&0!=b.away.reason.length&&!a.exclude.contains(c.ns)){var d=c.user.toLowerCase(),e=a.settings.username.toLowerCase();if(d!=e&&-1!=c.message.text().toLowerCase().indexOf(e)){var f=new Date,g=c.sns.toLowerCase();if(!(g in b.away.last&&f-b.away.last[g]<=b.away.interval)){var h=timeLengthString((f-b.away.since)/1e3),i=replaceAll(b.away.format.away,"{user}",c.user);i=replaceAll(i,"{timesince}",h),a.say(c.ns,replaceAll(i,"{reason}",b.away.reason)),b.away.last[g]=f
}}}};b.away.load=function(){b.away.format.setaway=c.get("setaway","/me is away: {reason}"),b.away.format.setback=c.get("setback","/me is back"),b.away.format.away=c.get("away","{user}: I've been away for {timesince}. Reason: {reason}"),b.away.interval=parseInt(c.get("interval",6e4))},b.away.save=function(){c.set("interval",b.away.interval),c.set("setaway",b.away.format.setaway),c.set("setback",b.away.format.setback),c.set("away",b.away.format.away)},d()},wsc.defaults.Extension.Ignore=function(a,b){var c=a.storage.folder("ignore");b.ignore={fignore:"/me is ignoring {user} now",funignore:"/me is not ignoring {user} anymore",ignored:[]};var d=function(){b.ignore.load(),b.ignore.save(),a.bind("cmd.ignore",e),a.bind("cmd.unignore",f)};b.ignore.load=function(){b.ignore.fignore=c.get("ignore",b.ignore.fignore),b.ignore.funignore=c.get("unignore",b.ignore.funignore),b.ignore.ignored=JSON.parse(c.get("ignored",JSON.stringify(b.ignore.ignored))),a.trigger("ignore.loaded",{name:"ignore.loaded",ignored:b.ignore.ignored})},b.ignore.save=function(){c.set("ignore",b.ignore.fignore),c.set("unignore",b.ignore.funignore),c.set("ignored",JSON.stringify(b.ignore.ignored))},b.ignore.add=function(c,d){var c=c.split(" "),e="";d=d||!1;for(var f=0;f<c.length;f++)c.hasOwnProperty(f)&&(e=c[f].toLowerCase(),-1==b.ignore.ignored.indexOf(e)&&(b.ignore.ignored.push(e),a.trigger("ignore.add",{name:"ignore.add",user:c[f],suppress:d})));b.ignore.save()},b.ignore.remove=function(c,d){var c=c.split(" "),e="",f=-1;d=d||!1;for(var g=0;g<c.length;g++)c.hasOwnProperty(g)&&(e=c[g].toLowerCase(),f=b.ignore.ignored.indexOf(e),-1!=f&&(b.ignore.ignored.splice(f,1),a.trigger("ignore.remove",{name:"ignore.remove",user:c[g],suppress:d})));b.ignore.save()};var e=function(a){b.ignore.add(a.args)},f=function(a){b.ignore.remove(a.args)};d()},wsc.Client=function(a,b,c){this.mozilla=c,this.storage=new wsc.Storage,this.storage.aj=this.storage.folder("autojoin"),this.storage.aj.channel=this.storage.aj.folder("channel"),this.fresh=!0,this.attempts=0,this.connected=!1,this.protocol=null,this.flow=null,this.ui=null,this.events=new EventEmitter,this.conn=null,this.channelo={},this.cchannel=null,this.cmds=[],this.settings={domain:"website.com",server:"ws://website.com/wsendpoint",symbol:"",username:"",userinfo:{},pk:"",monitor:["~Monitor",!0],welcome:"Welcome to the wsc web client!",autojoin:"chat:channel",protocol:wsc.Protocol,mparser:wsc.MessageParser,flow:wsc.Flow,extend:[wsc.defaults.Extension],client:"chatclient",clientver:"0.3",developer:!1};this.exclude=new StringSet,this.hidden=new StringSet,this.settings=Object.extend(this.settings,b),this.config_load(),this.config_save(),this.mw=new wsc.Middleware,this.settings.agent="Client ("+navigator.platform+"; HTML5; JavaScript) wsc/"+wsc.VERSION+"-r"+wsc.REVISION,this.mns=this.format_ns(this.settings.monitor[0]),this.lun=this.settings.username.toLowerCase(),this.protocol=new this.settings.protocol(new this.settings.mparser),this.flow=new this.settings.flow(this.protocol),this.build(),this.ext={},this.ext.defaults=wsc.defaults.Extension(this)},wsc.Client.prototype.config_load=function(){this.settings.developer="true"==this.storage.get("developer",this.settings.developer.toString())},wsc.Client.prototype.config_save=function(){this.storage.set("developer",this.settings.developer)},wsc.Client.prototype.build=function(){this.create_ns(this.settings.monitor[0],!0,!0)},wsc.Client.prototype.loop=function(){},wsc.Client.prototype.add_extension=function(a){this.settings.extend.push(a),a(this)},wsc.Client.prototype.bind=function(a,b){this.events.addListener(a,b),0!=a.indexOf("cmd.")||a.length<=4||(cmd=a.slice(4).toLowerCase(),this.cmds.push(cmd))},wsc.Client.prototype.clear_listeners=function(a){this.events.removeListeners(a)},wsc.Client.prototype.trigger=function(a,b){return this.events.emit(a,b,this)},wsc.Client.prototype.middle=function(a,b){return this.mw.add(a,b)},wsc.Client.prototype.cascade=function(a,b,c){this.mw.run(a,b,c)},wsc.Client.prototype.connect=function(){if(!this.connected){this.attempts++;try{var a=this;this.conn=wsc.Transport.Create(this.settings.server),this.conn.open(function(b,c){a.flow.open(a,b,c)}),this.conn.disconnect(function(b){a.flow.close(a,b)}),this.conn.message(function(b){a.flow.message(a,b)}),this.conn.connect(),this.trigger("start",new wsc.Packet("client connecting\ne=ok\n\n"))}catch(b){console.log(b),this.trigger("start",new wsc.Packet("client connecting\ne=no websockets available\n\n"))}}},wsc.Client.prototype.close=function(a){this.conn.close(a)},wsc.Client.prototype.channel=function(a,b){return a=this.format_ns(a).toLowerCase(),this.channelo[a]?this.channelo[a]:b?(this.channelo[a]=b,b):null},wsc.Client.prototype.channels=function(a){var b=[];for(ns in this.channelo)this.channelo.hasOwnProperty(ns)&&(this.channelo[ns].hidden||b.push(this.channelo[ns].namespace));return a?b:b.length},wsc.Client.prototype.each_channel=function(a,b){var c=null;for(var d in this.channelo)if(this.channelo.hasOwnProperty(d)&&(c=this.channelo[d],(b||!this.exclude.contains(c.raw))&&a(c.raw,c)===!1))break},wsc.Client.prototype.deform_ns=function(a){var b=a[0];if("#"==b||"@"==b||"~"==b||"+"==b)return a;if(0==a.indexOf("chat:"))return"#"+a.slice(5);if(0==a.indexOf("server:"))return"~"+a.slice(7);if(0==a.indexOf("feed:"))return"#"+a.slice(5);if(0==a.indexOf("login:"))return"@"+a.slice(6);if(0==a.indexOf("pchat:")){var c=a.split(":");c.shift();for(i in c)if(name=c[i],name.toLowerCase()!=this.lun)return"@"+name}return"#"+a},wsc.Client.prototype.format_ns=function(a){var b=a.slice(1);switch(a[0]){case"@":var c=[b,this.lun];c.sort(caseInsensitiveSort),c.unshift("pchat"),a=c.join(":");break;case"~":a="server:"+b;break;case"+":a="feed:"+b;break;case"#":a="chat:"+b;break;default:if(0==a.indexOf("chat:")||0==a.indexOf("pchat:")||0==a.indexOf("server:")||0==a.indexOf("feed:"))break;a="chat:"+a}return a},wsc.Client.prototype.create_ns=function(a,b,c){var d=this.channel(a,new wsc.Channel(this,a,b,c));this.trigger("ns.create",{name:"ns.create",ns:a,chan:d,client:this}),d.build()},wsc.Client.prototype.remove_ns=function(a){a&&this.cascade("ns.remove",function(a){var b=a.client.channel(a.ns);b&&delete a.client.channelo[b.raw.toLowerCase()]},{ns:a,client:this})},wsc.Client.prototype.select_ns=function(a){this.cchannel=this.channel(a)||this.cchannel},wsc.Client.prototype.log=function(a,b){var c=this.channel(a);c&&c.log(b)},wsc.Client.prototype.monitor=function(a){console.log(a)},wsc.Client.prototype.mute_user=function(){},wsc.Client.prototype.unmute_user=function(){},wsc.Client.prototype.send=function(a){return this.conn.send(a)},wsc.Client.prototype.handshake=function(){this.send(wsc_packetstr(this.settings.client,this.settings.clientver,{agent:this.settings.agent,url:window.location.href,browser:navigator.userAgent}))},wsc.Client.prototype.login=function(){pkt="login "+this.settings.username+"\npk="+this.settings.pk+"\n",this.send(pkt)},wsc.Client.prototype.pong=function(){this.send(wsc_packetstr("pong"))},wsc.Client.prototype.join=function(a){this.send(wsc_packetstr("join",this.format_ns(a)))},wsc.Client.prototype.part=function(a){this.send(wsc_packetstr("part",this.format_ns(a)))},wsc.Client.prototype.say=function(a,b){var c=this;this.cascade("send.msg",function(a){c.send(wsc_packetstr("send",c.format_ns(a.ns),{},wsc_packetstr("msg","main",{},a.input)))},{input:b,ns:a})},wsc.Client.prototype.npmsg=function(a,b){var c=this;this.cascade("send.npmsg",function(a){c.send(wsc_packetstr("send",c.format_ns(a.ns),{},wsc_packetstr("npmsg","main",{},a.input)))},{input:b,ns:a})},wsc.Client.prototype.action=function(a,b){var c=this;this.cascade("send.action",function(a){c.send(wsc_packetstr("send",c.format_ns(a.ns),{},wsc_packetstr("action","main",{},a.input)))},{input:b,ns:a})},wsc.Client.prototype.promote=function(a,b,c){this.send(wsc_packetstr("send",this.format_ns(a),{},wsc_packetstr("promote",b,{},c?c:"")))},wsc.Client.prototype.demote=function(a,b,c){this.send(wsc_packetstr("send",this.format_ns(a),{},wsc_packetstr("demote",b,{},c?c:"")))},wsc.Client.prototype.ban=function(a,b){this.send(wsc_packetstr("send",this.format_ns(a),{},wsc_packetstr("ban",b)))},wsc.Client.prototype.unban=function(a,b){this.send(wsc_packetstr("send",this.format_ns(a),{},wsc_packetstr("unban",b)))},wsc.Client.prototype.kick=function(a,b,c){var d=this;this.cascade("send.kick",function(a){d.send(wsc_packetstr("kick",d.format_ns(a.ns),{u:a.user},a.input||null))},{input:c||"",ns:a,user:b})},wsc.Client.prototype.kill=function(a,b){this.send(wsc_packetstr("kill","login:"+a,{},b||null))},wsc.Client.prototype.admin=function(a,b){this.send(wsc_packetstr("send",this.format_ns(a),{},wsc_packetstr("admin","",{},b)))},wsc.Client.prototype.property=function(a,b){this.send(wsc_packetstr("get",this.format_ns(a),{p:b}))},wsc.Client.prototype.set=function(a,b,c){var d=this;this.cascade("send.set",function(a){d.send(wsc_packetstr("set",d.format_ns(a.ns),{p:a.property},a.input))},{input:c,ns:a,property:b})},wsc.Client.prototype.whois=function(a){this.send(wsc_packetstr("get","login:"+a,{p:"info"}))},wsc.Client.prototype.disconnect=function(){this.send(wsc_packetstr("disconnect"))},function(a){a("*").hover(function(){a(this).data("hover",!0)},function(){a(this).data("hover",!1)}),a.fn.wsc=function(b,c){var d=a(window).data("wscclient");return("init"==b||void 0===d)&&(void 0==d&&(d=new wsc.Client(a(this),c,a.browser.mozilla||!1),setInterval(function(){d.loop()},12e4)),a(window).data("wscclient",d)),"init"!=b&&void 0!=b&&(b="jq_"+b,b in d&&d[b](a(this),c)),d},a.fn.wscui=function(b,c){return ui=a(window).data("wscui"),("init"==b||void 0===ui)&&(void 0==ui&&(ui=new Chatterbox.UI(a(this),c,a.browser.mozilla||!1),a(window).resize(ui.resize)),a(window).data("wscui",ui)),"init"!=b&&void 0!=b&&(b="jq_"+b,b in ui&&ui[b](a(this),c)),ui}}(jQuery);