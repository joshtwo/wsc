var wsc={};wsc.VERSION="1.7.51";wsc.STATE="release candidate";wsc.REVISION="0.21.136";wsc.defaults={};wsc.defaults.theme="wsct_dark";wsc.defaults.themes=["wsct_dAmn","wsct_dark"];function EventEmitter(){var g={},a=this;function f(k,l){var j=g[k]||false;if(j===false){g[k]=[l];return a}g[k].push(l);return a}function d(j){g[j]=[];return a}function b(){var j=Array.prototype.slice.call(arguments);var n=j.shift();var m=g[n]||false;var l=0;if(m===false){return l}for(var k in m){if(m.hasOwnProperty(k)){bubble=m[k].apply({},j);l++;if(bubble===false){break}}}return l}function h(j){return g[j]||[]}this.addListener=f;this.removeListeners=d;this.emit=b;this.listeners=h}var CryptoJS=CryptoJS||function(C,f){var j={},o=j.lib={},h=function(){},b=o.Base={extend:function(a){h.prototype=this;var g=new h;a&&g.mixIn(a);g.hasOwnProperty("init")||(g.init=function(){g.$super.init.apply(this,arguments)});g.init.prototype=g;g.$super=this;return g},create:function(){var a=this.extend();a.init.apply(a,arguments);return a
},init:function(){},mixIn:function(a){for(var g in a){a.hasOwnProperty(g)&&(this[g]=a[g])}a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},d=o.WordArray=b.extend({init:function(a,g){a=this.words=a||[];this.sigBytes=g!=f?g:4*a.length},toString:function(a){return(a||B).stringify(this)},concat:function(k){var n=this.words,l=k.words,m=this.sigBytes;k=k.sigBytes;this.clamp();if(m%4){for(var p=0;p<k;p++){n[m+p>>>2]|=(l[p>>>2]>>>24-8*(p%4)&255)<<24-8*((m+p)%4)}}else{if(65535<l.length){for(p=0;p<k;p+=4){n[m+p>>>2]=l[p>>>2]}}else{n.push.apply(n,l)}}this.sigBytes+=k;return this},clamp:function(){var a=this.words,g=this.sigBytes;a[g>>>2]&=4294967295<<32-8*(g%4);a.length=C.ceil(g/4)},clone:function(){var a=b.clone.call(this);a.words=this.words.slice(0);return a},random:function(g){for(var l=[],k=0;k<g;k+=4){l.push(4294967296*C.random()|0)}return new d.init(l,g)}}),z=j.enc={},B=z.Hex={stringify:function(l){var m=l.words;l=l.sigBytes;
for(var q=[],p=0;p<l;p++){var n=m[p>>>2]>>>24-8*(p%4)&255;q.push((n>>>4).toString(16));q.push((n&15).toString(16))}return q.join("")},parse:function(k){for(var l=k.length,n=[],m=0;m<l;m+=2){n[m>>>3]|=parseInt(k.substr(m,2),16)<<24-4*(m%8)}return new d.init(n,l/2)}},y=z.Latin1={stringify:function(k){var l=k.words;k=k.sigBytes;for(var n=[],m=0;m<k;m++){n.push(String.fromCharCode(l[m>>>2]>>>24-8*(m%4)&255))}return n.join("")},parse:function(k){for(var l=k.length,n=[],m=0;m<l;m++){n[m>>>2]|=(k.charCodeAt(m)&255)<<24-8*(m%4)}return new d.init(n,l)}},A=z.Utf8={stringify:function(a){try{return decodeURIComponent(escape(y.stringify(a)))}catch(k){throw Error("Malformed UTF-8 data")}},parse:function(a){return y.parse(unescape(encodeURIComponent(a)))}},x=o.BufferedBlockAlgorithm=b.extend({reset:function(){this._data=new d.init;this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=A.parse(a));this._data.concat(a);this._nDataBytes+=a.sigBytes},_process:function(p){var r=this._data,u=r.words,t=r.sigBytes,s=this.blockSize,n=t/(4*s),n=p?C.ceil(n):C.max((n|0)-this._minBufferSize,0);
p=n*s;t=C.min(4*p,t);if(p){for(var q=0;q<p;q+=s){this._doProcessBlock(u,q)}q=u.splice(0,p);r.sigBytes-=t}return new d.init(q,t)},clone:function(){var a=b.clone.call(this);a._data=this._data.clone();return a},_minBufferSize:0});o.Hasher=x.extend({cfg:b.extend(),init:function(a){this.cfg=this.cfg.extend(a);this.reset()},reset:function(){x.reset.call(this);this._doReset()},update:function(a){this._append(a);this._process();return this},finalize:function(a){a&&this._append(a);return this._doFinalize()},blockSize:16,_createHelper:function(a){return function(k,l){return(new a.init(l)).finalize(k)}},_createHmacHelper:function(a){return function(k,l){return(new w.HMAC.init(a,l)).finalize(k)}}});var w=j.algo={};return j}(Math);(function(y){function f(r,s,p,u,q,t,n){r=r+(s&p|~s&u)+q+n;return(r<<t|r>>>32-t)+s}function h(r,s,p,u,q,t,n){r=r+(s&u|p&~u)+q+n;return(r<<t|r>>>32-t)+s}function j(r,s,p,u,q,t,n){r=r+(s^p^u)+q+n;return(r<<t|r>>>32-t)+s}function g(r,s,p,u,q,t,n){r=r+(p^(s|~u))+q+n;return(r<<t|r>>>32-t)+s
}for(var b=CryptoJS,d=b.lib,o=d.WordArray,x=d.Hasher,d=b.algo,k=[],w=0;64>w;w++){k[w]=4294967296*y.abs(y.sin(w+1))|0}d=d.MD5=x.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(Q,N){for(var V=0;16>V;V++){var P=N+V,n=Q[P];Q[P]=(n<<8|n>>>24)&16711935|(n<<24|n>>>8)&4278255360}var V=this._hash.words,P=Q[N+0],n=Q[N+1],O=Q[N+2],L=Q[N+3],J=Q[N+4],H=Q[N+5],F=Q[N+6],E=Q[N+7],p=Q[N+8],m=Q[N+9],l=Q[N+10],a=Q[N+11],M=Q[N+12],K=Q[N+13],I=Q[N+14],G=Q[N+15],U=V[0],T=V[1],S=V[2],R=V[3],U=f(U,T,S,R,P,7,k[0]),R=f(R,U,T,S,n,12,k[1]),S=f(S,R,U,T,O,17,k[2]),T=f(T,S,R,U,L,22,k[3]),U=f(U,T,S,R,J,7,k[4]),R=f(R,U,T,S,H,12,k[5]),S=f(S,R,U,T,F,17,k[6]),T=f(T,S,R,U,E,22,k[7]),U=f(U,T,S,R,p,7,k[8]),R=f(R,U,T,S,m,12,k[9]),S=f(S,R,U,T,l,17,k[10]),T=f(T,S,R,U,a,22,k[11]),U=f(U,T,S,R,M,7,k[12]),R=f(R,U,T,S,K,12,k[13]),S=f(S,R,U,T,I,17,k[14]),T=f(T,S,R,U,G,22,k[15]),U=h(U,T,S,R,n,5,k[16]),R=h(R,U,T,S,F,9,k[17]),S=h(S,R,U,T,a,14,k[18]),T=h(T,S,R,U,P,20,k[19]),U=h(U,T,S,R,H,5,k[20]),R=h(R,U,T,S,l,9,k[21]),S=h(S,R,U,T,G,14,k[22]),T=h(T,S,R,U,J,20,k[23]),U=h(U,T,S,R,m,5,k[24]),R=h(R,U,T,S,I,9,k[25]),S=h(S,R,U,T,L,14,k[26]),T=h(T,S,R,U,p,20,k[27]),U=h(U,T,S,R,K,5,k[28]),R=h(R,U,T,S,O,9,k[29]),S=h(S,R,U,T,E,14,k[30]),T=h(T,S,R,U,M,20,k[31]),U=j(U,T,S,R,H,4,k[32]),R=j(R,U,T,S,p,11,k[33]),S=j(S,R,U,T,a,16,k[34]),T=j(T,S,R,U,I,23,k[35]),U=j(U,T,S,R,n,4,k[36]),R=j(R,U,T,S,J,11,k[37]),S=j(S,R,U,T,E,16,k[38]),T=j(T,S,R,U,l,23,k[39]),U=j(U,T,S,R,K,4,k[40]),R=j(R,U,T,S,P,11,k[41]),S=j(S,R,U,T,L,16,k[42]),T=j(T,S,R,U,F,23,k[43]),U=j(U,T,S,R,m,4,k[44]),R=j(R,U,T,S,M,11,k[45]),S=j(S,R,U,T,G,16,k[46]),T=j(T,S,R,U,O,23,k[47]),U=g(U,T,S,R,P,6,k[48]),R=g(R,U,T,S,E,10,k[49]),S=g(S,R,U,T,I,15,k[50]),T=g(T,S,R,U,H,21,k[51]),U=g(U,T,S,R,M,6,k[52]),R=g(R,U,T,S,L,10,k[53]),S=g(S,R,U,T,l,15,k[54]),T=g(T,S,R,U,n,21,k[55]),U=g(U,T,S,R,p,6,k[56]),R=g(R,U,T,S,G,10,k[57]),S=g(S,R,U,T,F,15,k[58]),T=g(T,S,R,U,K,21,k[59]),U=g(U,T,S,R,J,6,k[60]),R=g(R,U,T,S,a,10,k[61]),S=g(S,R,U,T,O,15,k[62]),T=g(T,S,R,U,m,21,k[63]);
V[0]=V[0]+U|0;V[1]=V[1]+T|0;V[2]=V[2]+S|0;V[3]=V[3]+R|0},_doFinalize:function(){var p=this._data,q=p.words,m=8*this._nDataBytes,r=8*p.sigBytes;q[r>>>5]|=128<<24-r%32;var n=y.floor(m/4294967296);q[(r+64>>>9<<4)+15]=(n<<8|n>>>24)&16711935|(n<<24|n>>>8)&4278255360;q[(r+64>>>9<<4)+14]=(m<<8|m>>>24)&16711935|(m<<24|m>>>8)&4278255360;p.sigBytes=4*(q.length+1);this._process();p=this._hash;q=p.words;for(m=0;4>m;m++){r=q[m],q[m]=(r<<8|r>>>24)&16711935|(r<<24|r>>>8)&4278255360}return p},clone:function(){var l=x.clone.call(this);l._hash=this._hash.clone();return l}});b.MD5=x._createHelper(d);b.HmacMD5=x._createHmacHelper(d)})(Math);wsc.Transport=function(f,b,d,a){this.sock=null;this.conn=null;this.server=f;this.open(b);this.message(d);this.disconnect(a)};wsc.Transport.Create=function(f,b,d,a){if(typeof io!=="undefined"){return new wsc.SocketIO(f,b,d,a)}if(!window.WebSocket){throw"This browser does not support websockets."}return new wsc.WebSocket(f,b,d,a)};wsc.Transport.prototype.open=function(a){this._open=a||this.sopen
};wsc.Transport.prototype.message=function(a){this._message=a||this.smessage};wsc.Transport.prototype.disconnect=function(a){this._disconnect=a||this.sdisconnect};wsc.Transport.prototype.sopen=function(){};wsc.Transport.prototype.smessage=function(){};wsc.Transport.prototype.sdisconnect=function(){};wsc.Transport.prototype._open=function(b,a){};wsc.Transport.prototype._message=function(a){};wsc.Transport.prototype._disconnect=function(a){};wsc.Transport.prototype.connect=function(){};wsc.Transport.prototype.send=function(a){};wsc.Transport.prototype.close=function(){};wsc.WebSocket=function(f,b,d,a){this.sock=null;this.conn=null;this.server=f;this.cause=null;this.open(b);this.message(d);this.disconnect(a)};wsc.WebSocket.prototype=new wsc.Transport;wsc.WebSocket.prototype.constructor=wsc.WebSocket;wsc.WebSocket.prototype.onopen=function(b,a){this.sock=a||this.conn;this._open(b,this)};wsc.WebSocket.prototype.ondisconnect=function(a){this.sock=null;this.conn=null;this._disconnect({wsEvent:a,cause:this.cause})
};wsc.WebSocket.prototype.connect=function(){var a=this;this.conn=new WebSocket(this.server);this.conn.onopen=function(d,b){a.onopen(d,b)};this.conn.onmessage=this._message;this.conn.onclose=function(b){a.ondisconnect(b)}};wsc.WebSocket.prototype.send=function(a){if(this.sock==null){return -1}return this.sock.send(replaceAll(escape(a).replace(/\%u([\dA-F]{4})/g,"%26%23x$1%3B"),"+","%2B"))};wsc.WebSocket.prototype.close=function(a){if(this.sock==null){return}this.cause=a;this.sock.close()};wsc.SocketIO=function(f,b,d,a){this.sock=null;this.conn=null;this.server=f;this.open(b);this.message(d);this.disconnect(a)};wsc.SocketIO.prototype=new wsc.Transport("");wsc.SocketIO.prototype.constructor=wsc.SocketIO;wsc.SocketIO.prototype.connect=function(){var a=this;this.conn=io.connect(this.server);this.conn.on("connect",function(d,b){a.onopen(d,b)});this.conn.on("message",function(b){a._message({data:b})});this.conn.on("close",function(b){a.ondisconnect(b)})};wsc.SocketIO.prototype.onopen=function(b,a){this.sock=a||this.conn;
this._open(b,this)};wsc.SocketIO.prototype.ondisconnect=function(a){this.sock=null;this.conn=null;this._disconnect(a)};wsc.SocketIO.prototype.send=function(a){if(this.sock==null){return -1}return this.sock.send(replaceAll(escape(a).replace(/\%u([\dA-F]{4})/g,"%26%23x$1%3B"),"+","%2B"))};wsc.SocketIO.prototype.close=function(){if(this.sock==null){return}this.sock.close()};function $_GET(d,b){b=b||window.location.search;var a=new RegExp("&"+d+"(?:=([^&]*))?(?=&|$)","i");b=b.replace(/^\?/,"&").match(a);if(b){return typeof b[1]!="undefined"?decodeURIComponent(b[1].replace(/\+/g,"%20")):""}}function UnixTimestamp(a){ret=new Date(a*1000);return ret}var Months=["January","February","March","April","May","June","July","August","September","October","November","December"];function PosEnd(a){return a=="1"?"st":(a=="2"?"nd":(a=="3"?"rd":"th"))}function DateStamp(a){a=UnixTimestamp(a);date=String(a.getDate());month=a.getMonth();df=date[date.length-1];return date+PosEnd(df)+" of "+Months[month]+", "+a.getFullYear()
}function caseInsensitiveSort(f,d){f=f.toLowerCase();d=d.toLowerCase();return((f>d)?1:(f<d?-1:0))}function EscapeRegExp(a){return a.replace((new RegExp("(\\"+["/",".","*","+","?","|","(",")","[","]","{","}","\\"].join("|\\")+")","g")),"\\$1")}String.format=function(){var a=Array.prototype.slice.call(arguments);var d=a.shift();a=a.shift();if(a.length==0){return d}var b=a.length;return d.replace(/{(\d+)}/g,function(f,g){if(b<=parseInt(g)){return f}return typeof a[g]!="undefined"?a[g]:f})};replaceAllRaw=function(d,b,a){while(d.indexOf(b)>-1){d=d.replace(b,a)}return d};replaceAll=function(d,b,a){return d.split(b).join(a)};Object.size=function(d){var b=0,a;for(a in d){if(d.hasOwnProperty(a)){b++}}return b};Object.steal=function(f,d){for(var g in d){if(!f.hasOwnProperty(g)&&!d.hasOwnProperty(g)){continue}if(typeof f[g]=="object"){f[g]=Object.extend(f[g],d[g])}else{f[g]=d[g]}}};Object.extend=function(f,d){var g={};Object.steal(g,f);Object.steal(g,d);return g};function zeroPad(b,a){a=a||2;a-=b.toString().length;
if(a>0){return new Array(a+(/\./.test(b)?2:1)).join("0")+b}return b+""}function formatTime(b,a){a=a||new Date();HH=a.getHours();hh=HH;b=replaceAll(b,"{mm}",zeroPad(a.getMinutes(),2));b=replaceAll(b,"{ss}",zeroPad(a.getSeconds(),2));mr="am";if(hh>11){mr="pm";if(hh>12){hh=hh-12}}else{if(hh==0){hh="12"}}b=replaceAll(b,"{hh}",zeroPad(hh,2));b=replaceAll(b,"{HH}",zeroPad(HH,2));b=replaceAll(b,"{mr}",mr);return b}function oxlist(a){last=a.pop();ret=a.join(", ");return ret+(ret.length>0?", and ":"")+last}function pluralise(b,a){return b+(a==1?"":"s")}function timeLengthString(d){if(d<=0){return"0 seconds."}var a=d;var f=[];f.unshift(["second",Math.round(a%60)]);a/=Math.round(60);f.unshift(["minute",Math.round(a%60)]);a/=Math.round(60);f.unshift(["hour",Math.round(a%24)]);a/=Math.round(24);f.unshift(["day",a]);var b=[];for(i in f){lapse=f[i];if(lapse[1]<1){continue}b.push(lapse[1].toString()+" "+pluralise(lapse[0],lapse[1]))}return oxlist(b)}function StringSet(a){this.items=a||[]}StringSet.prototype.add=function(b,a){if(!b){return false
}b=b.toLowerCase();if(this.contains(b)){return true}if(a){this.items.unshift(b)}else{this.items.push(b)}return true};StringSet.prototype.remove=function(a){if(!a){return false}a=a.toLowerCase();if(!this.contains(a)){return true}this.items.splice(this.items.indexOf(a),1);return true};StringSet.prototype.contains=function(a){if(!a){return false}return this.items.indexOf(a.toLowerCase())!=-1};wsc.Middleware=function(){this.callbacks={}};wsc.Middleware.prototype.add=function(b,d){var a=this.callbacks[b]||false;if(a===false){this.callbacks[b]=[]}this.callbacks[b].push(d);return this.callbacks[b].length};wsc.Middleware.prototype.run=function(b,g,d){var f=(this.callbacks[b]||[]).slice();f.push(g);var a=function(h){f.shift()(h,a)};a(d)};wsc.Storage=function(b,a){this.ns=b||null;this.parent=a||null};wsc.Storage.prototype.folder=function(a){if(this.ns!=null){a=this.ns+"."+a}return new wsc.Storage(a,this)};wsc.Storage.prototype.get=function(a,d){if(this.ns!=null){a=this.ns+"."+a}try{if(!localStorage.hasOwnProperty(a)){return d
}return localStorage[a]}catch(b){return d}};wsc.Storage.prototype.set=function(a,d){if(this.ns!=null){a=this.ns+"."+a}try{localStorage[a]=d}catch(b){}};wsc.Storage.prototype.remove=function(a){if(this.ns!=null){a=this.ns+"."+a}try{if(!localStorage.hasOwnProperty(a)){return false}return delete localStorage[a]}catch(b){}return false};var chains=[["recv","admin"]];wsc.Packet=function(f,h,a){if(!(f)){return null}if(a===undefined){a=true}h=h||"=";var b={cmd:null,param:null,arg:{},body:null,sub:[],raw:f};var k=null;var l=-1;try{l=f.indexOf("\n\n");if(l>-1){b.body=f.substr(l+2);f=f.substr(0,l)}k=f.split("\n");if(k[0].indexOf(h)==-1){cline=k.shift().split(" ");b.cmd=cline.shift()||null;b.param=cline.join(" ")||null}for(var d in k){arg=k[d];l=arg.search(h);if(l==-1){continue}b.arg[arg.substr(0,l)]=arg.substr(l+h.length)||""}if(b.body!=null&&a){subs=b.body.split("\n\n");for(var g in subs){sub=wsc.Packet(subs[g],h,false);if(sub==null){break}sub.body=subs.slice(g+1).join("\n\n");b.sub.push(sub)}}}catch(j){return null
}b.toString=function(){return packetToString(b)};b.name=packetEvtName(b);return b};function wsc_packetstr(g,h,d,a){var b="";if(g){b=g;if(h){b=b+" "+h}}if(d){for(var f in d){b=b+"\n"+f+"="+d[f]}}b=b+"\n";if(a){b=b+"\n"+a}return b}function packetToString(a){return wsc_packetstr(a.cmd,a.param,a.arg,a.body)}function packetEvtName(b){var f=b.cmd;var a=null;for(var d in chains){a=chains[d];if(a[0]!=f){continue}var g=b.sub[0];f=f+"_"+g.cmd;if(a.length>1&&g.param!=undefined){if(a[1]==g.cmd){return f+"_"+g.param}}}return f}wsc.Channel=function(b,d,f,a){this.info={members:{},pc:{},pc_order:[],title:{content:"",by:"",ts:""},topic:{content:"",by:"",ts:""},};this.client=b;this.hidden=f;this.monitor=(a==undefined?false:a);this.raw=b.format_ns(d);this.selector=(this.raw.substr(0,2)=="pc"?"pc":"c")+"-"+b.deform_ns(d).slice(1).toLowerCase();this.namespace=b.deform_ns(d);this.monitor=Object.size(this.client.channelo)==0};wsc.Channel.prototype.build=function(){this.info.members={};if(this.namespace[0]=="@"){this.set_privclasses({pkt:{body:""}})
}};wsc.Channel.prototype.property=function(a){var b=a.pkt.arg.p;switch(b){case"title":case"topic":this.set_header(b,a);break;case"privclasses":this.set_privclasses(a);break;case"members":this.set_members(a);break;default:this.server_message("Received unknown property "+b+" received in "+this.info.namespace+".");break}};wsc.Channel.prototype.set_header=function(a,b){this.info[a]["content"]=b.value.text()||"";this.info[a]["by"]=b.by;this.info[a]["ts"]=b.ts};wsc.Channel.prototype.set_privclasses=function(h){if(this.namespace[0]=="@"){this.info.pc={100:"Room Members"};this.info.pc_order=[100]}else{this.info.pc={};this.info.pc_order=[];var a=h.pkt.body.split("\n");var f=[];for(var b in a){if(!a.hasOwnProperty(b)){continue}f=a[b].split(":");if(f.length==1){continue}this.info.pc_order.push(parseInt(f[0]));this.info.pc[parseInt(f[0])]=f[1]}}this.info.pc_order.sort(function(k,j){return j-k});var g=this.info.pc;var d=this.info.pc_order.slice(0)};wsc.Channel.prototype.get_privclass_order=function(a){a=a.toLowerCase();
for(var b in this.info.pc){if(!this.info.pc.hasOwnProperty(b)){continue}if(this.info.pc[b].toLowerCase()==a){return b}}};wsc.Channel.prototype.set_members=function(b){this.info.members={};for(var a in b.pkt.sub){if(!b.pkt.sub.hasOwnProperty(a)){continue}this.register_user(b.pkt.sub[a],true)}this.set_user_list()};wsc.Channel.prototype.set_user_list=function(){if(Object.size(this.info.members)==0){return}var d=this.get_usernames();var f=[];var b=null;for(var a in d){if(!d.hasOwnProperty(a)){continue}f.push(this.info.members[d[a]])}this.client.trigger("ns.user.list",{name:"set.userlist",ns:this.namespace,users:f})};wsc.Channel.prototype.user_info=function(a){var d=this.info.members[a];var b=d.symbol;return{name:a,pc:d.pc||"Room Members",symbol:b,conn:d.conn,hover:{member:d,name:a,avatar:'<img class="avatar" src="" height="50" width="50" />',link:b+'<a target="_blank" href="http://'+a+"."+this.client.settings.domain+'/">'+a+"</a>",info:[]}}};wsc.Channel.prototype.register_user=function(a,d){var b=a.param;
if(this.info.members[b]==undefined){this.info.members[b]=a.arg;this.info.members[b]["username"]=b;this.info.members[b]["conn"]=1;this.info.members[b]=this.user_info(b)}else{for(i in a.arg){this.info.members[b][i]=a.arg[i]}this.info.members[b]["conn"]++}if(!("pc" in this.info.members[b])){this.info.members[b]["pc"]="Room Members"}d=d||false;if(d){return}this.client.trigger("ns.user.registered",{name:"ns.user.registered",ns:this.namespace,user:b})};wsc.Channel.prototype.get_usernames=function(){var b=[];for(var a in this.info.members){b.push(a)}b.sort(caseInsensitiveSort);return b};wsc.Channel.prototype.remove_user=function(a,b){b=b||false;var d=this.info.members[a];if(d==undefined){return}d.conn--;if(d.conn==0||b){delete this.info.members[a]}this.client.trigger("ns.user.remove",{user:d.name,ns:this.namespace})};wsc.Channel.prototype.recv_join=function(b){var a=new wsc.Packet("user "+b.user+"\n"+b.info);this.register_user(a)};wsc.Channel.prototype.recv_part=function(a){this.remove_user(a.user)
};wsc.Channel.prototype.recv_privchg=function(a){var b=this;this.client.cascade("ns.user.privchg",function(d){var f=b.info.members[d.user];if(!f){return}f.pc=d.pc},a)};wsc.Channel.prototype.recv_kicked=function(a){this.remove_user(a.user,true);this.set_user_list()};wsc.MessageString=function(a,b){this._parser=b||new wsc.MessageParser();this.raw=a};with(wsc.MessageString.prototype=new String){constructor=wsc.MessageParser;toString=valueOf=function(){return this.raw}}wsc.MessageString.prototype.html=function(){return this.raw};wsc.MessageString.prototype.text=function(){return this.raw};wsc.MessageString.prototype.ansi=function(){return this.raw};wsc.MessageParser=function(){};wsc.MessageParser.prototype.parse=function(a){return new wsc.MessageString(a,this)};wsc.MessageParser.prototype.render=function(b,a){return a.raw};wsc.Protocol=function(b){this.mparser=b||new wsc.MessageParser;this.chains=[["recv","admin"]];this.maps={chatserver:["version"],login:["username",["e"],"data"],join:["ns",["e"]],part:["ns",["e","*r"]],property:["ns",["p","by","ts"],"*value"],recv_msg:[null,[["from","user"]],"*message"],recv_npmsg:[null,[["from","user"]],"message"],recv_action:[null,["s",["from","user"]],"*message"],recv_join:["user",["s"],"*info"],recv_part:["user",["s","r"]],recv_privchg:["user",["s","by","pc"]],recv_kicked:["user",[["i","s"],"by"],"*r"],recv_admin_create:[null,["p",["by","user"],["name","pc"],"privs"]],recv_admin_update:[null,["p",["by","user"],["name","pc"],"privs"]],recv_admin_rename:[null,["p",["by","user"],"prev",["name","pc"]]],recv_admin_move:[null,["p",["by","user"],"prev",["name","pc"],["n","affected"]]],recv_admin_remove:[null,["p",["by","user"],["name","pc"],["n","affected"]]],recv_admin_show:[null,["p"],"info"],recv_admin_showverbose:[null,["p"],"info"],recv_admin_privclass:[null,["p","e"],"command"],kicked:["ns",[["by","user"]],"*r"],ping:[],disconnect:[null,["e"]],send:["ns",["e"]],kick:["ns",[["u","user"],"e"]],get:["ns",["p","e"]],set:["ns",["p","e"]],kill:["ns",["e"]],unknown:[null,null,null,"packet"],};
var a=this;this.mapper={recv:function(g,f,d){f.ns=g.param;return a.map(g.sub[0],f,d)}}};wsc.Protocol.prototype.extend_maps=function(b){for(var a in b){this.maps[a]=b[a]}};wsc.Protocol.prototype.populate_keys=function(){this.tkeys={};for(var d in this.maps){if(!this.maps.hasOwnProperty(d)){continue}var h=this.maps[d];var g="";this.tkeys[d]=[];for(var f in h){if(!h.hasOwnProperty(f)){continue}g=h[f];if(!g){continue}if(f==1){var b="";for(var a in g){if(!g.hasOwnProperty(a)){continue}b=g[a];if(!b){continue}if(b instanceof Array){b=b[1]}if(b[0]=="*"){this.tkeys[d].push(b.substr(1))}else{this.tkeys[d].push(b)}}continue}if(g[0]=="*"){this.tkeys[d].push(g.substr(1))}else{this.tkeys[d].push(g)}}}};wsc.Protocol.prototype.parse=function(d){var b=this.event(d);if(!(b in this.maps)){console.log("unknown: ",b);console.log(this.maps);mapping=this.maps.unknown;b="unknown"}else{mapping=this.maps[b]}var a={name:b,pkt:d,ns:null};cmd=d.cmd;if(this.mapper[cmd]){this.mapper[cmd](d,a,mapping)}else{this.map(d,a,mapping)
}return a};wsc.Protocol.prototype.event=function(b){var f=b.cmd;var a=null;for(var d in this.chains){a=this.chains[d];if(a[0]!=f){continue}var g=b.sub[0];f=f+"_"+g.cmd;if(a.length>1&&g.param!=undefined){if(a[1]==g.cmd){return f+"_"+g.param}}}return f};wsc.Protocol.prototype.map=function(d,b,a){for(var j in a){if(a[j]==null){continue}var l=a[j];var m=l;var h="",g="";switch(parseInt(j)){case 0:b[l]=d.param;break;case 1:if(a[1] instanceof Array){for(var f in a[1]){l=a[1][f];if(l instanceof Array){b[l[1]]=d.arg[l[0]];m=l[1]}else{var h=l[0]=="*"?l.slice(1):l;b[l]=d.arg[h]||"";m=l}}}if(typeof a[1]=="string"){b[l]=d.arg.slice(0)}break;case 2:if(l instanceof Array){d.sub[0].sub=d.sub.slice(1);this.map(d.sub[0],b,l)}else{b[l]=d.body}break;case 3:b[l]=d.raw;break}if(m[0]!="*"){continue}h=m.slice(1);g=this.mparser.parse(b[m]);b[h]=g}};wsc.Flow=function(a){this.protocol=a||new wsc.Protocol()};wsc.Flow.prototype.open=function(a,d,b){a.trigger("connected",{name:"connected",pkt:new wsc.Packet("connected\n\n")});
a.connected=true;a.handshake();a.attempts=0};wsc.Flow.prototype.close=function(b,d){var a={name:"closed",pkt:new wsc.Packet("connection closed\n\n"),reason:"",evt:d,connected:b.connected,sio:b.conn instanceof wsc.SocketIO,cause:d.cause||null,reconnect:true};var f={name:"log",ns:"~System",msg:"",info:""};b.trigger("closed",a);if(b.connected){f.msg="Connection closed";b.trigger("log",f);b.connected=false;if(b.conn instanceof wsc.SocketIO){f.msg="At the moment there is a problem with reconnecting with socket.io";f.info="Refresh to connect";b.trigger("log",f);f.info="";return}}else{f.msg="Connection failed";b.trigger("log",f)}a.name="quit";if(b.attempts>2){a.reconnect=false;b.attempts=0;b.trigger("quit",a);return}if(d.cause){if(d.cause.hasOwnProperty("name")&&d.cause.name=="login"){b.trigger("quit",a);return}}setTimeout(function(){b.connect()},2000)};wsc.Flow.prototype.message=function(a,f){var b=new wsc.Packet(unescape(replaceAll(f.data,"+"," ")));if(b==null){return}var d=this.protocol.parse(b);
if(d.ns==null){d.ns=a.mns}d.sns=a.deform_ns(d.ns);this.handle(a,d);a.trigger("pkt",d);a.trigger("pkt."+d.name,d)};wsc.Flow.prototype.handle=function(a,d){try{this[d.name](d,a)}catch(b){}};wsc.Flow.prototype.ping=function(b,a){a.pong()};wsc.Flow.prototype.chatserver=function(b,a){a.login()};wsc.Flow.prototype.login=function(d,a){if(d.pkt.arg.e=="ok"){var g=d.pkt.sub[0];a.settings.username=d.pkt.param;a.settings.symbol=g.arg.symbol;a.settings.userinfo=g.arg;var b=function(){a.join(a.settings.autojoin);if(a.autojoin.on){for(var h in a.autojoin.channel){if(!a.autojoin.channel.hasOwnProperty(h)){continue}a.join(a.autojoin.channel[h])}}};if(a.fresh){b()}else{var f=false;for(key in a.channelo){if(a.channelo[key].namespace[0]!="~"){a.join(key);f=true}}if(!f){b()}}}else{a.close(d)}if(a.fresh){a.fresh=false}};wsc.Flow.prototype.join=function(d,a){if(d.pkt.arg["e"]=="ok"){var b=a.deform_ns(d.pkt.param);a.create_ns(b,a.hidden.contains(d.pkt.param))}else{a.trigger("log",{name:"log",ns:"server:current",sns:"~current",msg:"Failed to join "+a.deform_ns(d.pkt.param),info:d.pkt.arg["e"]})
}};wsc.Flow.prototype.part=function(d,a){var b=a.deform_ns(d.ns);var f=a.channel(b);if(d.e=="ok"){info="";if(d.r.length>0){info="["+d.r+"]"}else{a.remove_ns(d.ns)}msg="You have left "+b;f.server_message(msg,info);if(a.channels()==0){switch(d.r){case"bad data":case"bad msg":case"msg too big":break;default:if(d.r.indexOf("killed:")<0){return}break}this.message(a,{data:"disconnect\ne="+e.r+"\n"})}}else{a.trigger("log",{name:"log",ns:"server:current",sns:"~current",msg:"Couldn't leave "+b,info:d.e})}};wsc.Flow.prototype.kicked=function(b,a){if(b.r.toLowerCase().indexOf("autokicked")>-1){return}a.join(b.ns)};wsc.Flow.prototype.property=function(b,a){chan=a.channel(b.pkt.param);if(!chan){return}chan.property(b)};wsc.Flow.prototype.recv_joinpart=function(b,a){c=a.channel(b.ns);if(b.name=="recv_join"){c.recv_join(b)}else{c.recv_part(b)}};wsc.Flow.prototype.recv_join=wsc.Flow.prototype.recv_joinpart;wsc.Flow.prototype.recv_part=wsc.Flow.prototype.recv_joinpart;wsc.Flow.prototype.recv_msg=function(b,a){a.channel(b.ns).recv_msg(b)
};wsc.Flow.prototype.recv_action=wsc.Flow.prototype.recv_msg;wsc.Flow.prototype.recv_npmsg=wsc.Flow.prototype.recv_msg;wsc.Flow.prototype.recv_privchg=function(b,a){a.channel(b.ns).recv_privchg(b)};wsc.Flow.prototype.recv_kicked=function(b,a){a.channel(b.ns).recv_kicked(b)};wsc.defaults.Extension=function(b){var d={};var j=function(){b.bind("cmd.connect",f.connection);b.bind("cmd.set",f.setter);b.bind("cmd.join",f.join);b.bind("cmd.chat",f.pjoin);b.bind("cmd.part",f.part);b.bind("cmd.say",f.say);b.bind("cmd.npmsg",f.npmsg);b.bind("cmd.me",f.action);b.bind("cmd.promote",f.chgpriv);b.bind("cmd.demote",f.chgpriv);b.bind("cmd.ban",f.ban);b.bind("cmd.unban",f.ban);b.bind("cmd.kick",f.killk);b.bind("cmd.whois",f.whois);b.bind("cmd.title",f.title);b.bind("cmd.topic",f.title);b.bind("cmd.admin",f.admin);b.bind("cmd.disconnect",f.connection);b.bind("cmd.kill",f.killk);b.bind("cmd.raw",f.raw);b.bind("cmd.close",f.close);b.bind("pkt.property",g);b.bind("pkt.recv_admin_show",a);b.bind("pkt.recv_admin_showverbose",a);
b.bind("pkt.get",h);b.bind("cmd.gettitle",f.gett);b.bind("cmd.gettopic",f.gett);b.bind("cmd.theme",f.theme)};d.save=function(l,k){b.settings.ui.theme=l.theme;b.settings.ui.clock=l.clock;b.settings.ui.tabclose=l.tabclose};var f={};f.theme=function(l,k){k.ui.theme(l.args.split(" ").shift())};f.setter=function(m){var l=m.args.split(" ");var k=l.shift().toLowerCase();var l=l.join(" ");if(l.length==0){b.cchannel.serverMessage("Could not set "+k,"No data supplied");return}if(!(k in b.settings)){b.cchannel.serverMessage('Unknown setting "'+k+'"');return}b.settings[k]=l;b.cchannel.serverMessage("Changed "+k+" setting","value: "+l)};f.connection=function(k){b[k.cmd]()};f.join=function(k){var l=k.args.split(" ");var l=l.toString()==""?[]:l;if(k.ns!=k.target){l.unshift(k.target)}if(l.toString()==""){return}for(index in l){b.join(l[index])}};f.pjoin=function(k){var l=k.args.split(" ");var l=l.toString()==""?[]:l;if(k.ns!=k.target){l.unshift(k.target)}if(l.toString()==""){return}for(index in l){b.join("@"+l[index])
}};f.part=function(k){var l=k.args.split(" ");if(k.ns!=k.target){l.unshift(k.target)}if(l.toString()==""){b.part(k.ns);return}for(index in l){b.part(l[index])}};f.title=function(k){b.set(k.target,k.cmd,k.args)};f.chgpriv=function(l){var k=l.args.split(" ");b[l.cmd.toLowerCase()](l.target,k[0],k[1])};f.ban=function(o,k){var m=o.args.split(" ");var l=m.shift();var n=o.cmd;if(n=="ban"&&m.length>0){k.kick(o.target,l,m.join(" "))}k[n](o.target,l)};f.action=function(k){b.action(k.target,k.args)};f.raw=function(k){b.send(k.args.replace(/\\n/gm,"\n"))};f.killk=function(n,k){var o=n.args.split(" ");var l=o.shift();var m=o.length>0?o.join(" "):null;if(n.cmd=="kick"){k.kick(n.target,l,m)}else{k.kill(l,m)}};f.say=function(k){if(b.channel(k.target).monitor){return}b.say(k.target,k.args)};f.npmsg=function(k){b.npmsg(k.target,k.args)};f.clear=function(m,k){if(m.args.length>0){var n=m.args.split(" ");for(var l in n){if(!n.hasOwnProperty(l)){continue}k.ui.channel(m.target).clear_user(n[l])}}else{k.ui.channel(m.target).clear()
}};f.clearall=function(l,k){var n=null;if(l.args.length>0){var m=l.args.split(" ");n=function(p,q){for(var o in m){if(!m.hasOwnProperty(o)){continue}q.clear_user(m[o])}}}else{n=function(o,p){p.clear()}}k.ui.chatbook.each(n,true)};f.close=function(k){b.part(k.target);b.remove_ns(k.target)};f.whois=function(l,k){k.whois(l.args.split(" ")[0])};f.admin=function(l,k){k.admin(l.target,l.args)};f.disconnect=function(l,k){k.disconnect()};f.gett=function(l,k){var m=l.cmd.indexOf("title")>-1?"title":"topic";k.ui.control.set_text("/"+m+" "+k.channel(l.target).info[m].content)};var g=function(p,l){if(p.p!="info"){return}var n=p.pkt.sub;var q=n.shift().arg;q.username=p.sns.substr(1);q.connections=[];var o=null;var r={};while(n.length>0){r=n.shift();switch(r.cmd){case"conn":if(o!=null){q.connections.push(o)}o=r.arg;o.channels=[];break;case"agent":o.agent=[["agent",r.arg.agent]];if(r.arg.hasOwnProperty("url")){o.agent.push(["url",r.arg.url])}if(r.arg.hasOwnProperty("browser")){o.agent.push(["browser",r.arg.browser])
}for(var m in r.arg){if(m=="agent"||m=="url"||m=="browser"){continue}if(r.arg.hasOwnProperty(m)){o.agent.push([m,r.arg[m]])}}break;case"ns":o.channels.unshift(l.deform_ns(r.param));break}}q.connections.push(o);l.trigger("pkt.whois",{name:"pkt.whois",pkt:p.pkt,info:q})};var h=function(l,k){if(l.ns.indexOf("login:")!=0){return}var m=l.sns.substr(1);k.ui.pager.notice({ref:"whois-"+m,heading:"Whois Failed",content:"Whois failed for "+m+".\nNo such user online."},false,5000)};var a=function(o,l){var r=l.channel(o.ns);var k=o.info.split("\n");var q="";var p=[];var m="";for(var n in k){if(!k.hasOwnProperty(n)){continue}q=k[n].split(" ");if(o.p=="privclass"){p.push([q.shift(),q.shift().split("=")[1],q.join(" ")])}else{if(o.p=="users"){m=q.shift().split(":",1)[0];p.push([m,r.get_privclass_order(m),q.join(" ")])}}}l.ui.chatbook.current.log_pc(o.p=="privclass",p)};j();wsc.defaults.Extension.Ignore(b);wsc.defaults.Extension.Away(b,d);wsc.defaults.Extension.Autojoin(b);return d};wsc.defaults.Extension.Autojoin=function(a){var d=a.autojoin;
var f=function(){a.bind("cmd.autojoin",b)};d.join=function(){for(var g in a.autojoin.channel){if(!a.autojoin.channel.hasOwnProperty(g)){continue}a.join(a.autojoin.channel[g])}};d.add=function(g){if(a.autojoin.channel.indexOf(g)!=-1){return false}a.autojoin.channel.push(g);a.config_save();return true};d.remove=function(h){var g=a.autojoin.channel.indexOf(h);if(g==-1){return false}a.autojoin.channel.splice(g,1);a.config_save();return true};var b=function(h){var m=h.args.split(" ");if(!m){return}var p=m.shift().toLowerCase();var n=null;var q="";var j="";var o=false;var g=a.channel(h.ns);switch(p){case"add":n=d.add;q="Added {item} to your autojoin.";j="Already have {item} on your autojoin.";break;case"rem":case"remove":n=d.remove;q="Removed {item} from your autojoin.";j=r+" is not on your autojoin list.";break;case"on":a.trigger("log",{name:"log",ns:"server:current",sns:"~current",msg:"Autojoin on"});if(!a.autojoin.on){o=true;a.autojoin.on=true}break;case"off":a.trigger("log",{name:"log",ns:"server:current",sns:"~current",msg:"Autojoin off"});
if(a.autojoin.on){o=true;a.autojoin.on=false}break;default:d.join();break}var r="";var l=false;if(n!=null){for(var k in m){if(!m.hasOwnProperty(k)){continue}r=a.deform_ns(m[k]).toLowerCase();l=n(r);a.trigger("log",{name:"log",ns:"server:current",sns:"~current",msg:replaceAll((l?q:j),"{item}",r)})}}if(o){a.config_save()}};f()};wsc.defaults.Extension.Away=function(b,f){var j=b.storage.folder("away");f.away={on:false,reason:"",last:{},since:0,interval:60000,format:{setaway:"/me is away: {reason}",setback:"/me is back",away:"{user}: I've been away for {timesince}. Reason: {reason}"}};b.away=f.away;var h=function(){f.away.load();f.away.save();b.bind("cmd.setaway",d);b.bind("cmd.setback",g);b.bind("pkt.recv_msg",a);b.bind("pkt.recv_action",a)};var d=function(m,k){f.away.on=true;f.away.last={};f.away.since=new Date();f.away.reason=m.args;var n=k.say;var l=replaceAll(f.away.format.setaway,"{reason}",f.away.reason||"[silent away]");if(l.indexOf("/me ")==0){l=l.substr(4);n=k.action}k.each_channel(function(o){n.call(k,o,l)
});k.trigger("ext.away.away",{name:"ext.away.away",reason:f.away.reason||"[silent away]"})};var g=function(m,k){if(!f.away.on){return}f.away.on=false;var n=k.say;var l=f.away.format.setback;if(l.indexOf("/me ")==0){l=l.substr(4);n=k.action}k.each_channel(function(o){n.call(k,o,l)});k.trigger("ext.away.back",{name:"ext.away.back"})};var a=function(o){if(!f.away.on){return}if(f.away.reason.length==0){return}if(b.exclude.contains(o.ns)){return}var p=o.user.toLowerCase();var l=b.settings.username.toLowerCase();if(p==l){return}if(o.message.text().toLowerCase().indexOf(l)==-1){return}var m=new Date();var n=o.sns.toLowerCase();if(n in f.away.last){if((m-f.away.last[n])<=f.away.interval){return}}var k=timeLengthString((m-f.away.since)/1000);var q=replaceAll(f.away.format.away,"{user}",o.user);q=replaceAll(q,"{timesince}",k);b.say(o.ns,replaceAll(q,"{reason}",f.away.reason));f.away.last[n]=m};f.away.load=function(){f.away.format.setaway=j.get("setaway","/me is away: {reason}");f.away.format.setback=j.get("setback","/me is back");
f.away.format.away=j.get("away","{user}: I've been away for {timesince}. Reason: {reason}");f.away.interval=parseInt(j.get("interval",60000))};f.away.save=function(){j.set("interval",f.away.interval);j.set("setaway",f.away.format.setaway);j.set("setback",f.away.format.setback);j.set("away",f.away.format.away)};h()};wsc.defaults.Extension.Ignore=function(d){var f={};var g=d.storage.folder("ignore");var a=g.folder("ignored");var l=function(){k();j();d.bind("cmd.ignore",b);d.bind("cmd.unignore",h)};var b=function(p){var r=p.args.split(" ");var m="";var q="";var o=false;for(var n in r){if(!r.hasOwnProperty(n)){continue}m=r[n];tmod=d.mute_user(m);if(!tmod){continue}o=tmod;q=replaceAll(f.ignore,"{user}",m);if(q.indexOf("/me ")==0){q=q.substr(4);d.action(p.target,q)}else{d.say(p.target,q)}}if(o){j()}};var h=function(q){var t=q.args.split(" ");var n="";var s="";var m=-1;var p=false;var r=false;for(var o in t){if(!t.hasOwnProperty(o)){continue}n=t[o];r=d.unmute_user(n);if(!r){continue}p=r;s=replaceAll(f.unignore,"{user}",n);
if(s.indexOf("/me ")==0){s=s.substr(4);d.action(q.target,s)}else{d.say(q.target,s)}}if(p){j()}};var k=function(){f.ignore=g.get("ignore","/me is ignoring {user} now");f.unignore=g.get("unignore","/me is not ignoring {user} anymore");f.count=parseInt(g.get("count",0));var n=null;if(f.count>0){n=null;for(var m=0;m<f.count;m++){}}};var j=function(){g.set("ignore",f.ignore);g.set("unignore",f.unignore);for(var m=0;m<f.count;m++){a.remove(m)}};l()};wsc.Client=function(b,d,f){this.mozilla=f;this.storage=new wsc.Storage;this.storage.aj=this.storage.folder("autojoin");this.storage.aj.channel=this.storage.aj.folder("channel");this.fresh=true;this.attempts=0;this.connected=false;this.protocol=null;this.flow=null;this.ui=null;this.events=new EventEmitter();this.conn=null;this.channelo={};this.cchannel=null;this.cmds=[];this.settings={domain:"website.com",server:"ws://website.com/wsendpoint",symbol:"",username:"",userinfo:{},pk:"",monitor:["~Monitor",true],welcome:"Welcome to the wsc web client!",autojoin:"chat:channel",protocol:wsc.Protocol,mparser:wsc.MessageParser,flow:wsc.Flow,extend:[wsc.defaults.Extension],client:"chatclient",clientver:"0.3",developer:false};
this.autojoin={on:true,count:0,channel:[]};this.away={};var a=this;this.exclude=new StringSet();this.hidden=new StringSet();this.settings=Object.extend(this.settings,d);this.config_load();this.config_save();this.mw=new wsc.Middleware();this.settings.agent="Client ("+navigator.platform+"; HTML5; JavaScript) wsc/"+wsc.VERSION+"-r"+wsc.REVISION;this.mns=this.format_ns(this.settings.monitor[0]);this.lun=this.settings.username.toLowerCase();this.protocol=new this.settings.protocol(new this.settings.mparser());this.flow=new this.settings.flow(this.protocol);this.build();this.ext={};this.ext.defaults=wsc.defaults.Extension(this)};wsc.Client.prototype.config_load=function(){this.settings.developer=(this.storage.get("developer",this.settings.developer.toString())=="true");this.autojoin.on=(this.storage.aj.get("on","true")=="true");this.autojoin.count=parseInt(this.storage.aj.get("count","0"));this.autojoin.channel=[];var a=null;var d=0;for(var b=0;b<this.autojoin.count;b++){a=this.storage.aj.channel.get(b,null);
if(a==null){continue}d++;this.autojoin.channel.push(a)}this.autojoin.count=d};wsc.Client.prototype.config_save=function(){this.storage.set("developer",this.settings.developer);this.storage.aj.set("on",this.autojoin.on.toString());this.storage.aj.set("count",this.autojoin.count);for(var a=0;a<this.autojoin.count;a++){this.storage.aj.channel.remove(a)}if(this.autojoin.channel.length==0){this.storage.aj.set("count",0)}else{var b=-1;for(var a in this.autojoin.channel){if(!this.autojoin.channel.hasOwnProperty(a)){continue}b++;this.storage.aj.channel.set(b.toString(),this.autojoin.channel[a])}b++;this.storage.aj.set("count",b)}};wsc.Client.prototype.build=function(){this.create_ns(this.settings.monitor[0],true,true);var a=this};wsc.Client.prototype.loop=function(){};wsc.Client.prototype.add_extension=function(a){this.settings.extend.push(a);a(this)};wsc.Client.prototype.bind=function(b,a){this.events.addListener(b,a);if(b.indexOf("cmd.")!=0||b.length<=4){return}cmd=b.slice(4).toLowerCase();this.cmds.push(cmd)
};wsc.Client.prototype.clear_listeners=function(a){this.events.removeListeners(a)};wsc.Client.prototype.trigger=function(a,b){return this.events.emit(a,b,this)};wsc.Client.prototype.middle=function(a,b){return this.mw.add(a,b)};wsc.Client.prototype.cascade=function(a,d,b){this.mw.run(a,d,b)};wsc.Client.prototype.connect=function(){if(this.connected){return}this.attempts++;try{var a=this;this.conn=wsc.Transport.Create(this.settings.server);this.conn.open(function(d,f){a.flow.open(a,d,f)});this.conn.disconnect(function(d){a.flow.close(a,d)});this.conn.message(function(d){a.flow.message(a,d)});this.conn.connect();this.trigger("start",new wsc.Packet("client connecting\ne=ok\n\n"))}catch(b){console.log(b);this.trigger("start",new wsc.Packet("client connecting\ne=no websockets available\n\n"))}};wsc.Client.prototype.close=function(a){this.conn.close(a)};wsc.Client.prototype.channel=function(a,b){a=this.format_ns(a).toLowerCase();if(!this.channelo[a]){if(b){this.channelo[a]=b;return b}return null
}return this.channelo[a]};wsc.Client.prototype.channels=function(b){var a=[];for(ns in this.channelo){if(!this.channelo.hasOwnProperty(ns)){continue}if(this.channelo[ns].hidden){continue}a.push(this.channelo[ns].namespace)}return b?a:a.length};wsc.Client.prototype.each_channel=function(f,a){var d=null;for(var b in this.channelo){if(!this.channelo.hasOwnProperty(b)){continue}d=this.channelo[b];if(!a){if(this.exclude.contains(d.raw)){continue}}if(f(d.raw,d)===false){break}}};wsc.Client.prototype.deform_ns=function(b){var a=b[0];if(a=="#"||a=="@"||a=="~"||a=="+"){return b}if(b.indexOf("chat:")==0){return"#"+b.slice(5)}if(b.indexOf("server:")==0){return"~"+b.slice(7)}if(b.indexOf("feed:")==0){return"#"+b.slice(5)}if(b.indexOf("login:")==0){return"@"+b.slice(6)}if(b.indexOf("pchat:")==0){var d=b.split(":");d.shift();for(i in d){name=d[i];if(name.toLowerCase()!=this.lun){return"@"+name}}}return"#"+b};wsc.Client.prototype.format_ns=function(a){var d=a.slice(1);switch(a[0]){case"@":var b=[d,this.lun];
b.sort(caseInsensitiveSort);b.unshift("pchat");a=b.join(":");break;case"~":a="server:"+d;break;case"+":a="feed:"+d;break;case"#":a="chat:"+d;break;default:if(a.indexOf("chat:")==0||a.indexOf("pchat:")==0||a.indexOf("server:")==0||a.indexOf("feed:")==0){break}a="chat:"+a;break}return a};wsc.Client.prototype.create_ns=function(b,d,a){var f=this.channel(b,new wsc.Channel(this,b,d,a));this.trigger("ns.create",{name:"ns.create",ns:b,chan:f,client:this});f.build()};wsc.Client.prototype.remove_ns=function(a){if(!a){return}this.cascade("ns.remove",function(b){var d=b.client.channel(b.ns);if(!d){return}delete b.client.channelo[d.raw.toLowerCase()]},{ns:a,client:this})};wsc.Client.prototype.select_ns=function(a){this.cchannel=this.channel(a)||this.cchannel};wsc.Client.prototype.log=function(a,b){var d=this.channel(a);if(!d){return}d.log(b)};wsc.Client.prototype.monitor=function(a){console.log(a)};wsc.Client.prototype.mute_user=function(a){};wsc.Client.prototype.unmute_user=function(a){};wsc.Client.prototype.send=function(a){return this.conn.send(a)
};wsc.Client.prototype.handshake=function(){this.send(wsc_packetstr(this.settings.client,this.settings.clientver,{agent:this.settings.agent,url:window.location.href,browser:navigator.userAgent}))};wsc.Client.prototype.login=function(){pkt="login "+this.settings.username+"\npk="+this.settings.pk+"\n";this.send(pkt)};wsc.Client.prototype.pong=function(){this.send(wsc_packetstr("pong"))};wsc.Client.prototype.join=function(a){this.send(wsc_packetstr("join",this.format_ns(a)))};wsc.Client.prototype.part=function(a){this.send(wsc_packetstr("part",this.format_ns(a)))};wsc.Client.prototype.say=function(a,b){var d=this;this.cascade("send.msg",function(f){d.send(wsc_packetstr("send",d.format_ns(f.ns),{},wsc_packetstr("msg","main",{},f.input)))},{input:b,ns:a})};wsc.Client.prototype.npmsg=function(a,b){var d=this;this.cascade("send.npmsg",function(f){d.send(wsc_packetstr("send",d.format_ns(f.ns),{},wsc_packetstr("npmsg","main",{},f.input)))},{input:b,ns:a})};wsc.Client.prototype.action=function(a,b){var d=this;
this.cascade("send.action",function(f){d.send(wsc_packetstr("send",d.format_ns(f.ns),{},wsc_packetstr("action","main",{},f.input)))},{input:b,ns:a})};wsc.Client.prototype.promote=function(d,a,b){this.send(wsc_packetstr("send",this.format_ns(d),{},wsc_packetstr("promote",a,{},(!b?"":b))))};wsc.Client.prototype.demote=function(d,a,b){this.send(wsc_packetstr("send",this.format_ns(d),{},wsc_packetstr("demote",a,{},(!b?"":b))))};wsc.Client.prototype.ban=function(b,a){this.send(wsc_packetstr("send",this.format_ns(b),{},wsc_packetstr("ban",a)))};wsc.Client.prototype.unban=function(b,a){this.send(wsc_packetstr("send",this.format_ns(b),{},wsc_packetstr("unban",a)))};wsc.Client.prototype.kick=function(b,a,d){var f=this;this.cascade("send.kick",function(g){f.send(wsc_packetstr("kick",f.format_ns(g.ns),{u:g.user},g.input||null))},{input:d||"",ns:b,user:a})};wsc.Client.prototype.kill=function(a,b){this.send(wsc_packetstr("kill","login:"+a,{},b||null))};wsc.Client.prototype.admin=function(a,b){this.send(wsc_packetstr("send",this.format_ns(a),{},wsc_packetstr("admin","",{},b)))
};wsc.Client.prototype.property=function(a,b){this.send(wsc_packetstr("get",this.format_ns(a),{p:b}))};wsc.Client.prototype.set=function(a,d,b){var f=this;this.cascade("send.set",function(g){f.send(wsc_packetstr("set",f.format_ns(g.ns),{p:g.property},g.input))},{input:b,ns:a,property:d})};wsc.Client.prototype.whois=function(a){this.send(wsc_packetstr("get","login:"+a,{p:"info"}))};wsc.Client.prototype.disconnect=function(){this.send(wsc_packetstr("disconnect"))};(function(a){a("*").hover(function(b){a(this).data("hover",true)},function(b){a(this).data("hover",false)});a.fn.wsc=function(f,d){var b=a(window).data("wscclient");if(f=="init"||b===undefined){if(b==undefined){b=new wsc.Client(a(this),d,(a.browser.mozilla||false));setInterval(function(){b.loop()},120000)}a(window).data("wscclient",b)}if(f!="init"&&f!=undefined){f="jq_"+f;if(f in b){b[f](a(this),d)}}return b};a.fn.wscui=function(d,b){ui=a(window).data("wscui");if(d=="init"||ui===undefined){if(ui==undefined){ui=new Chatterbox.UI(a(this),b,(a.browser.mozilla||false));
a(window).resize(ui.resize)}a(window).data("wscui",ui)}if(d!="init"&&d!=undefined){d="jq_"+d;if(d in ui){ui[d](a(this),b)}}return ui}})(jQuery);